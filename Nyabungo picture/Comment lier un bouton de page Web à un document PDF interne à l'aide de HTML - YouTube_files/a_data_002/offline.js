(function(g){var window=this;'use strict';var BP4=function(G){var m=new g.dr("und",new g.oN("Default","und",!0));m.captionTracks=G.captionTracks;return m},ACb=function(G){return new g.t_(function(m,w){var W=G.length,U=[];
if(W)for(var c=function(q,T){W--;U[q]=T;W==0&&m(U)},Q=function(q){w(q)},D,O=0;O<G.length;O++)D=G[O],g.Fy6(D,g.qn(c,O),Q);
else m(U)})},hR=function(G){this.V=G},lr=function(){hR.apply(this,arguments)},XR4=function(){lr.apply(this,arguments)},yCH=function(){lr.apply(this,arguments)},GQm=function(){lr.apply(this,arguments)},mv9=function(){lr.apply(this,arguments)},wTR=function(){lr.apply(this,arguments)},Waq=function(){lr.apply(this,arguments)},Uvf=function(){lr.apply(this,arguments)},sWm=function(){hR.apply(this,arguments)},cem=function(){lr.apply(this,arguments)},QWH=function(){lr.apply(this,arguments)},vIm=function(){lr.apply(this,
arguments)},Dvz=function(){lr.apply(this,arguments)},O2d=function(){lr.apply(this,arguments)},qpq=function(){lr.apply(this,arguments)},Tsd=function(){lr.apply(this,arguments)},$ve=function(){lr.apply(this,arguments)},aSH=function(){lr.apply(this,arguments)},Z2q=function(){lr.apply(this,arguments)},kQq=function(){lr.apply(this,arguments)},i2H=function(){lr.apply(this,arguments)},Kaf=function(){hR.apply(this,arguments)},Nsm=function(){lr.apply(this,arguments)},ISf=function(){lr.apply(this,arguments)},
zYz=function(){lr.apply(this,arguments)},VQg=function(){lr.apply(this,arguments)},MQq=function(){lr.apply(this,arguments)},LaR=function(){lr.apply(this,arguments)},b2z=function(){lr.apply(this,arguments)},tQz=function(){lr.apply(this,arguments)},gIf=function(){lr.apply(this,arguments)},dvn=function(){hR.apply(this,arguments)},fSe=function(){hR.apply(this,arguments)},RYq=function(){hR.apply(this,arguments)},pTH=function(){lr.apply(this,arguments)},jW4=function(){lr.apply(this,arguments)},Sp9=function(){lr.apply(this,
arguments)},PZH=function(){lr.apply(this,arguments)},oIR=function(){lr.apply(this,arguments)},hYg=function(){lr.apply(this,arguments)},lSz=function(){lr.apply(this,arguments)},CZH=function(){lr.apply(this,arguments)},EIq=function(){lr.apply(this,arguments)},Jee=function(){lr.apply(this,arguments)},re4=function(){lr.apply(this,arguments)},FaH=function(){lr.apply(this,arguments)},eYn=function(){lr.apply(this,arguments)},nIb=function(){lr.apply(this,arguments)},xvb=function(){lr.apply(this,arguments)},
ugH=function(){lr.apply(this,arguments)},H2c=function(){lr.apply(this,arguments)},Ypq=function(){lr.apply(this,arguments)},Bsd=function(){lr.apply(this,arguments)},Aed=function(){lr.apply(this,arguments)},XTf=function(){lr.apply(this,arguments)},yez=function(){lr.apply(this,arguments)},GGR=function(){lr.apply(this,arguments)},m9R=function(){lr.apply(this,arguments)},w54=function(){lr.apply(this,arguments)},Wtc=function(){lr.apply(this,arguments)},U94=function(){lr.apply(this,arguments)},svf=function(){hR.apply(this,
arguments)},c_g=function(){lr.apply(this,arguments)},Qvz=function(){lr.apply(this,arguments)},v8g=function(){lr.apply(this,arguments)},D9q=function(){lr.apply(this,arguments)},OqR=function(){lr.apply(this,arguments)},qKq=function(){lr.apply(this,arguments)},T8H=function(){lr.apply(this,arguments)},$99=function(){lr.apply(this,arguments)},ax9=function(){lr.apply(this,arguments)},Zq4=function(){lr.apply(this,arguments)},kGH=function(){lr.apply(this,arguments)},iqd=function(){lr.apply(this,arguments)},
KtR=function(){lr.apply(this,arguments)},N8g=function(){lr.apply(this,arguments)},Ixf=function(){lr.apply(this,arguments)},z_d=function(){lr.apply(this,arguments)},VYR=function(){lr.apply(this,arguments)},MYH=function(){lr.apply(this,arguments)},Ltq=function(){lr.apply(this,arguments)},bqb=function(){lr.apply(this,arguments)},tYz=function(){lr.apply(this,arguments)},g8b=function(){lr.apply(this,arguments)},d9d=function(){lr.apply(this,arguments)},fxH=function(){lr.apply(this,arguments)},R_H=function(){lr.apply(this,
arguments)},p5q=function(){lr.apply(this,arguments)},jvH=function(){lr.apply(this,arguments)},SKq=function(){lr.apply(this,arguments)},POd=function(){lr.apply(this,arguments)},o8R=function(){lr.apply(this,arguments)},h_R=function(){lr.apply(this,arguments)},lx9=function(){lr.apply(this,arguments)},CO9=function(){lr.apply(this,arguments)},E8m=function(G){G=G.key||G.id;
if(!G)throw Error("Entity key is missing");return G},J_f=function(){if(Cl)return Cl();
var G={};Cl=g.BL("PersistentEntityStoreDb",{H7:(G.EntityStore={qH:1},G.EntityAssociationStore={qH:2},G),shared:!1,upgrade:function(m,w){w(1)&&g.pY(g.b2(m,"EntityStore",{keyPath:"key"}),"entityType","entityType");w(2)&&(m=g.b2(m,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.pY(m,"byParentEntityKey","parentEntityKey"),g.pY(m,"byChildEntityKey","childEntityKey"))},
version:3});return Cl()},r_9=function(G){return g.E3(J_f(),G)},FtH=function(G){return g.E3((0,g.bib)(),G)},EM=function(G){this.token=G},JR=function(G,m){m=m===void 0?{}:m;
g.J0.call(this,g.tog[G],Object.assign({},{name:"PESEncoderError",type:G},m));this.type=G;this.level="WARNING";Object.setPrototypeOf(this,JR.prototype)},e_q=function(G){return new JR("WRONG_DATA_TYPE",{jR:G})},n8f=function(G){return G instanceof Error?new JR("UNKNOWN_ENCODE_ERROR",{originalMessage:G.message}):new JR("UNKNOWN_ENCODE_ERROR")},x99=function(G){return G instanceof Error?new JR("UNKNOWN_DECODE_ERROR",{originalMessage:G.message}):new JR("UNKNOWN_DECODE_ERROR")},uog=function(G,m){G=G instanceof
JR?G:m(G);
g.dR(G);throw G;},HqH=function(){},YK9=function(G,m,w){try{return G.X(m,w)}catch(W){uog(W,n8f)}},B8n=function(G){G=(new TextEncoder).encode(G).subarray(0,16);
var m=new Uint8Array(16);m.set(G);return m},rW=function(G){this.V=G},X5H=function(G){var m=A_c[G];
if(m)return m;g.f4(new g.J0("Entity model not found.",{entityType:G}))},y_c=function(G,m){this.V=G;
this.Y=m;this.X={}},mab=function(G,m){a:{G=GA4(G.Y,m.version);
try{var w=G.Y(m.data,m.key);break a}catch(W){uog(W,x99)}w=void 0}return w},Fi=function(G,m,w){return G.V.objectStore("EntityStore").get(m).then(function(W){if(W){if(w&&W.entityType!==w)throw Error("Incorrect entity type");
return mab(G,W)}})},en=function(G,m,w){return w?(w=w.map(function(W){return Fi(G,W,m)}),g.KY.all(w)):G.V.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(m)).then(function(W){return W.map(function(U){return mab(G,U)})})},xd=function(G,m,w){var W=E8m(m),U=GA4(G.Y,1),c=Object.assign({},m);
return G.V.objectStore("EntityStore").get(W).then(function(Q){if(Q){if(Q.entityType!==w)throw Error("Incorrect entity type");c.entityMetadata||(Q=mab(G,Q),c.entityMetadata=Q.entityMetadata)}}).then(function(){var Q={key:W,
entityType:w,data:YK9(U,c,W),version:1};return g.KY.all([g.dU(G.V.objectStore("EntityStore"),Q),wEH(G,c,w)])}).then(function(){nl(G,W,w);
return W})},W6d=function(G,m,w){m=m.map(function(W){return xd(G,W,w)});
return g.KY.all(m)},ur=function(G,m,w){if(w==null?0:w.M4){var W=new Set;
return UaH(G,m,W).then(function(){for(var c=[],Q=g.V(W),D=Q.next();!D.done;D=Q.next())c.push(ur(G,D.value));return g.KY.all(c).then(function(){})})}var U=g.Hd(m).entityType;
return g.KY.all([G.V.objectStore("EntityStore").delete(m),s2q(G,m)]).then(function(){nl(G,m,U)})},c3H=function(G,m){return g.oj(G.V.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(m)},function(w){return g.KY.all([w.delete(),
s2q(G,w.cursor.primaryKey)]).then(function(){nl(G,w.cursor.primaryKey,m);return g.SE(w)})})},Q2z=function(G,m,w,W){var U=GA4(G.Y,1);
return Fi(G,m,W).then(function(c){if(c){c=g.wn(c,w);var Q={key:m,entityType:W,data:YK9(U,c,m),version:1};return g.KY.all([g.dU(G.V.objectStore("EntityStore"),Q),wEH(G,c,W)])}}).then(function(){nl(G,m,W);
return m})},nl=function(G,m,w){var W=G.X[w];
W||(W=new Set,G.X[w]=W);W.add(m)},v9f=function(G,m,w){var W=E8m(m);
w=X5H(w);if(!w)return g.KY.resolve([]);w=new w(m);G=G.V.objectStore("EntityAssociationStore");m=[];w=g.V(w.Y());for(var U=w.next();!U.done;U=w.next())m.push(g.dU(G,{parentEntityKey:W,childEntityKey:U.value}));return g.KY.all(m).then(function(c){return c.map(function(Q){return Q[1]})})},s2q=function(G,m){return G.V.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(m))},wEH=function(G,m,w){var W=E8m(m);
return s2q(G,W).then(function(){return v9f(G,m,w)})},UaH=function(G,m,w){if(w.has(m))return g.KY.resolve(void 0);
w.add(m);return Dac(G,m).then(function(W){return G.V.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(m)).then(function(){return W})}).then(function(W){var U=g.KY.resolve(void 0);
W=g.V(W);for(var c=W.next(),Q={};!c.done;Q={BM:void 0},c=W.next())Q.BM=c.value,U=U.then(function(D){return function(){return UaH(G,D.BM,w)}}(Q));
return U}).then(function(){})},Dac=function(G,m){var w=G.V.objectStore("EntityAssociationStore");
return w.index("byParentEntityKey").getAll(IDBKeyRange.only(m)).then(function(W){var U=[];W=g.V(W);for(var c=W.next();!c.done;c=W.next())c=c.value,U.push(w.index("byChildEntityKey").getAll(c.childEntityKey));return g.KY.all(U)}).then(function(W){var U=[];
W=g.V(W);for(var c=W.next();!c.done;c=W.next())c=c.value,c.length===1&&U.push(c[0].childEntityKey);return U})},HD=function(){},Oad=function(){this.V={};
this.V[0]=new HD;if(!g.am("aes_pes_encoder_killswitch")){var G=this.V;try{var m=g.re();var w=B8n(m);var W=new rW(new g.Dp(w),new g.O5(w))}catch(U){throw G=U instanceof Error?new JR("KEY_CREATION_FAILED",{originalMessage:U.message}):new JR("KEY_CREATION_FAILED"),g.dR(G),G;}G[1]=W}},GA4=function(G,m){m=m===void 0?0:m;
G=G.V[m];if(!G)throw m=new JR("INVALID_ENCODER_VERSION",{jR:m}),g.dR(m),m;return G},Yd=function(G,m){g.J.call(this);
this.token=G;this.V=m;this.observers=[];G=new g.X6.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.re());G.onmessage=this.Y.bind(this);this.channel=G},BD=function(G,m,w){var W,U,c,Q;
return g.h(function(D){if(D.Y==1)return g.S(D,r_9(G.token),2);if(D.Y!=3)return W=D.V,g.S(D,g.gU(W,["EntityStore","EntityAssociationStore"],m,function(O){U=new y_c(O,G.V);return w(U)}),3);
c=D.V;U&&(Q=U.X,Object.keys(Q).length>0&&(G.channel.postMessage(Q),qlH(G,Q)));return D.return(c)})},AR=function(G,m,w){return BD(G,{mode:"readwrite",
p5:!0},function(W){return xd(W,m,w)})},T2c=function(G,m){return BD(G,{mode:"readwrite",
p5:!0},function(w){return W6d(w,m,"offlineOrchestrationActionWrapperEntity")})},$ac=function(G,m){return BD(G,{mode:"readwrite",
p5:!0},function(w){return ur(w,m)})},aaR=function(G){return BD(G,{mode:"readwrite",
p5:!0},function(m){return c3H(m,"videoPlaybackPositionEntity")})},Xi=function(G,m,w){return BD(G,{mode:"readonly",
p5:!0},function(W){return Fi(W,m,w)})},yB=function(G,m,w){return BD(G,{mode:"readonly",
p5:!0},function(W){return en(W,m,w)})},qlH=function(G,m){G=g.V(G.observers);
for(var w=G.next();!w.done;w=G.next())w=w.value,w(m)},Zac=function(){var G,m,w;
return g.h(function(W){if(W.Y==1)return g.MV(W,2),g.S(W,g.HL(),4);if(W.Y!=2){G=W.V;if(!G||!g.FR()||typeof g.X6.BroadcastChannel==="undefined")return W.return();m=new Oad;return W.return(new Yd(G,m))}w=g.fH(W);w instanceof Error&&g.dR(w);return W.return()})},GY=function(){kAc||(kAc=Zac());
return kAc},iac=function(G){var m;
G=(m=G.options)==null?void 0:m.persistenceOption;return G==="ENTITY_PERSISTENCE_OPTION_PERSIST"||G==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},K6H=function(G){var m;
return g.h(function(w){return w.Y==1?g.S(w,GY(),2):(m=w.V)?g.S(w,BD(m,"readwrite",function(W){for(var U={},c=g.V(G),Q=c.next(),D={};!Q.done;D={g7:void 0,AN:void 0},Q=c.next())D.g7=Q.value,D.g7.entityKey&&iac(D.g7)&&(D.AN=g.WY(D.g7.payload),Q=void 0,D.g7.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(Q=function(O){return function(){return xd(W,O.g7.payload[O.AN],O.AN)}}(D)),D.g7.type==="ENTITY_MUTATION_TYPE_DELETE"&&(Q=function(O){return function(){return ur(W,O.g7.entityKey)}}(D)),D.g7.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(Q=function(O){return function(){return Q2z(W,O.g7.entityKey,O.g7.payload[O.AN],O.AN)}}(D)),Q&&(U[D.g7.entityKey]=U[D.g7.entityKey]?U[D.g7.entityKey].then(Q):Q()));
return g.KY.all(Object.values(U))}),0):w.return()})},N24=function(G){var m;
return g.h(function(w){if(w.Y==1){m=G.mutations;if(!m||m.length<=0)return w.return();if(g.gl){var W={type:"ENTITY_LOADED"};m!==void 0&&(W.payload=m);g.gl.dispatch(W)}return g.S(w,K6H(m),2)}m.length=0;g.VZ(w)})},Iaf=function(G){return G!==void 0},zPb=function(G){var m=g.W9();
m=Object.assign({},m);G=Object.assign({},G);for(var w in m)G[w]?(m[w]!==4&&(m[w]=G[w]),delete G[w]):m[w]!==2&&(m[w]=4);Object.assign(m,G);g.hLW(m);JSON.stringify(m);return m},V_f=function(G){var m,w;
return g.h(function(W){if(W.Y==1)return g.S(W,g.HL(),2);if(W.Y!=3)return(m=W.V)?g.S(W,g.c9(m),3):W.return();w=W.V;return W.return(g.gU(w,["index","media","captions"],{mode:"readwrite",p5:!0},function(U){var c=IDBKeyRange.bound(G+"|",G+"~");U=[U.objectStore("index").delete(c),U.objectStore("media").delete(c),U.objectStore("captions").delete(c)];return g.KY.all(U).then(function(){})}))})},M_q=function(){var G,m;
return g.h(function(w){if(w.Y==1)return g.S(w,g.HL(),2);if(w.Y!=3){G=w.V;if(!G)throw g.kc("rvdfd");return g.S(w,g.c9(G),3)}m=w.V;return w.return(g.gU(m,["index","media"],{mode:"readwrite",p5:!0},function(W){var U={};return g.jE(W.objectStore("index"),{},function(c){var Q=c.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),D=g.KY.resolve(void 0);if(Q){var O=Q[1];Q=Q[2];U[O]=U[O]||{};var q;U[O][Q]=g.rv6((q=c.getValue())==null?void 0:q.fmts)}else D=c.delete().then(function(){});
return g.KY.all([g.SE(c),D]).then(function(T){return g.V(T).next().value})}).then(function(){for(var c={},Q=g.V(Object.keys(U)),D=Q.next();!D.done;D=Q.next()){D=D.value;
var O=U[D].v;c[D]=U[D].a&&O?1:2}var q=zPb(c);return g.L3q(W.objectStore("media"),{},function(T){var a=T.cursor.key.match(g.xzd);a&&c[a[1]]||W.objectStore("media").delete(T.cursor.key);return g.ZTV(T)}).then(function(){return q})})}))})},L6H=function(G,m){var w,W;
return g.h(function(U){if(U.Y==1)return g.S(U,g.HL(),2);if(U.Y!=3){w=U.V;if(!w)throw g.kc("wct");return g.S(U,g.c9(w),3)}W=U.V;return g.S(U,g.gU(W,["captions"],{mode:"readwrite",p5:!0},function(c){var Q=[];c=c.objectStore("captions");for(var D=0;D<m.length;D++){var O=g.dU(c,m[D],G+"|"+m[D].metadata.vss_id);Q.push(O)}return g.KY.all(Q)}),0)})},ba4=function(G){var m,w,W;
return g.h(function(U){if(U.Y==1)return m=IDBKeyRange.bound(G+"|",G+"~"),g.S(U,g.HL(),2);if(U.Y!=3){w=U.V;if(!w)throw g.kc("gactfv");return g.S(U,g.c9(w),3)}W=U.V;return U.return(W.getAll("captions",m))})},t_H=function(G){return g.h(function(m){g.s8(G,0);
return m.return(V_f(G))})},g9z=function(G){return{context:g.HZ(),
videoIds:G}},dad=function(G){return{context:g.HZ(),
playlistIds:G}},faz=function(G){return{context:g.HZ(),
offlinePlaylistSyncChecks:G}},RPz=function(){this.V=new Map},j2g=function(){pEq||(pEq=new RPz);
return pEq},SlH=function(G,m){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:G},metadata:m,statusCode:void 0,csn:void 0,can:void 0}},Pcc=function(G,m,w){if(!w){var W=W===void 0?!1:W;
w=G.V.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!w||W)w=g.iy(16),G.V.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",w)}G={flowNonce:w,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:m.eventType};m.metadata&&(G.flowMetadata=m.metadata);m.statusCode!==void 0&&(G.flowEventStatus=m.statusCode);m.csn&&(G.csn=m.csn);m.can&&(G.can=m.can);g.U3("flowEvent",G,void 0)},o99=function(G){var m,w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF,lR,nd,vY,p,FK;
return g.h(function(Sb){if(Sb.Y==1)return g.S(Sb,BD(G,{mode:"readonly",p5:!0},function(WW){return en(WW,"playbackData").then(function(bR){var L=bR.map(function(rc){return rc.transfer}).filter(function(rc){return!!rc}),wd=bR.map(function(rc){return rc.offlineVideoPolicy}).filter(function(rc){return!!rc}),gQ=bR.filter(function(rc){return!!rc.key}).map(function(rc){return g.Yi(g.Hd(rc.key).entityId,"downloadStatusEntity")});
L=en(WW,"transfer",L);wd=en(WW,"offlineVideoPolicy",wd);gQ=en(WW,"downloadStatusEntity",gQ);var vk=L.then(function(rc){rc=rc.reduce(function(uq,wc){(wc==null?0:wc.offlineVideoStreams)&&uq.push.apply(uq,g.Z$(wc.offlineVideoStreams));return uq},[]).filter(function(uq){return!!uq});
return en(WW,"offlineVideoStreams",rc)});
return g.KY.all([L,wd,vk,gQ]).then(function(rc){var uq=g.V(rc);rc=uq.next().value;var wc=uq.next().value;var wO=uq.next().value;uq=uq.next().value;return[bR,rc,wc,wO,uq]})})}),2);
if(Sb.Y!=3)return m=Sb.V,g.S(Sb,BD(G,{mode:"readonly",p5:!0},function(WW){return en(WW,"mainDownloadsListEntity").then(function(bR){var L,wd;return(wd=(L=bR[0])==null?void 0:L.downloads)!=null?wd:[]})}),3);
w=Sb.V;W=g.V(m);U=W.next().value;c=W.next().value;Q=W.next().value;D=W.next().value;O=W.next().value;q=U;T=c;a=Q;Z=D;k=O;K={};M={};t={};R={};f={};P=[];E=g.V(T);for(e=E.next();!e.done;e=E.next())(A=e.value)&&(K[A.key]=A);Y=g.V(a);for(vW=Y.next();!vW.done;vW=Y.next())(Oo=vW.value)&&(M[Oo.key]=Oo);QZ=g.V(k);for(D$=QZ.next();!D$.done;D$=QZ.next())(me=D$.value)&&(t[me.key]=me);dd=g.V(Z);for(Y6=dd.next();!Y6.done;Y6=dd.next())(Gm=Y6.value)&&(R[Gm.key]=Gm);iR=g.V(w);for(vg=iR.next();!vg.done;vg=iR.next())pH=
vg.value,QF=void 0,f[(QF=pH.videoItem)!=null?QF:""]=!0,pH.videoItem&&(nd=lR=void 0,vY=(nd=(lR=g.Hd(pH.videoItem))==null?void 0:lR.entityId)!=null?nd:"",P.push({externalVideoId:vY}));p=q.filter(function(WW){if(!WW||!WW.key||!WW.offlineVideoPolicy)return!1;WW=g.Hd(WW.key).entityId;WW=g.Yi(WW,"downloadStatusEntity");var bR;return!(WW&&((bR=t[WW])==null?void 0:bR.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
FK=p.map(function(WW){var bR=K[WW.transfer],L=[];if(bR==null?0:bR.offlineVideoStreams)for(var wd=g.V(bR.offlineVideoStreams),gQ=wd.next();!gQ.done;gQ=wd.next())(gQ=R[gQ.value])&&L.push(gQ);wd=M[WW.offlineVideoPolicy];gQ=f;var vk=WW==null?void 0:WW.playerResponseTimestamp,rc=g.Hd(wd.key).entityId;WW=g.Yi(rc,"mainVideoEntity");if(wd.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var uq="OFFLINE_VIDEO_STATE_DISABLED";wd.expirationTimestamp&&Number(wd.expirationTimestamp)<Date.now()/1E3&&(uq="OFFLINE_VIDEO_STATE_EXPIRED")}else if(wd.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")uq="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(bR==null?void 0:bR.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":uq="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":uq="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":uq="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":uq="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":uq="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":uq="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:uq="OFFLINE_VIDEO_STATE_UNKNOWN"}if(uq==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(bR==null?void 0:bR.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":uq="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":uq="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":uq=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}rc={id:rc,videoState:uq};if(bR==null?0:bR.cotn)rc.cotn=bR.cotn;if(bR==null?0:bR.maximumDownloadQuality)rc.selectedVideoQuality=bR==null?void 0:bR.maximumDownloadQuality;if(bR==null?0:bR.lastProgressTimeMs)rc.lastProgressTimeMs=bR.lastProgressTimeMs;vk&&(rc.playerResponseSavedTimeMs=String(Number(vk)*1E3));bR=String;vk=0;L=g.V(L);for(uq=L.next();!uq.done;uq=L.next())if(uq=uq.value,uq.streamsProgress){uq=g.V(uq.streamsProgress);for(var wc=uq.next();!wc.done;wc=uq.next()){var wO=
void 0;vk+=Number((wO=wc.value.numBytesDownloaded)!=null?wO:0)}}rc.downloadedBytes=bR(vk);rc.selectedOfflineMode=gQ[WW]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";wd.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(rc.offlinePlaybackDisabledReason=wd.offlinePlaybackDisabledReason);return rc});
return Sb.return({offlineVideos:FK,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:P}}})})},hP9=function(){this.locks=navigator.locks},la4=function(){try{var G=g.m4("ytglobal.locks_");
if(G)return G;var m;if(m=navigator){var w=navigator;m="locks"in w&&!!w.locks}if(m)return g.X6.localStorage&&g.X6.localStorage.getItem("noop"),G=new hP9,g.yZ("ytglobal.locks_",G),G}catch(W){}},mV=function(){},CcH=function(){},E9m=function(G){if(G.includes(":"))throw Error("Invalid user cache name: "+G);
return G+":"+g.re("CacheStorage get")},J3z=function(){return g.h(function(G){if(wE!==void 0)return G.return(wE);
wE=new Promise(function(m){var w;return g.h(function(W){switch(W.Y){case 1:return g.MV(W,2),g.S(W,WS.open("test-only"),4);case 4:return g.S(W,WS.delete("test-only"),5);case 5:g.tU(W,3);break;case 2:if(w=g.fH(W),w instanceof Error&&w.name==="SecurityError")return m(!1),W.return();case 3:m("caches"in window),g.VZ(W)}})});
return G.return(wE)})},F6H=function(){return g.h(function(G){if(G.Y==1)return g.S(G,J3z(),2);
if(!G.V)return G.return(void 0);r3g||(r3g=new CcH);return G.return(r3g)})},Ui=function(G,m,w){g.f4(new g.J0("Woffle: "+G,w?{cotn:w}:""));
m instanceof Error&&g.f4(m)},ePn=function(G){var m;
return g.h(function(w){if(w.Y==1)return g.S(w,o99(G),2);m=w.V;g.U3("offlineStateSnapshot",m);g.VZ(w)})},si=function(G){g.J.call(this);
var m=this;this.api=G;this.VU={YA6:function(){return m.V},
RDj:function(){return m.Y}};
typeof g.X6.BroadcastChannel!=="undefined"&&(this.V=new g.X6.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.re()),this.V.onmessage=this.X.bind(this),this.Y=new g.X6.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.re()),this.Y.onmessage=this.D.bind(this))},cS=function(G,m){G.api.G2("onOfflineOperationFailure",m);
var w;(w=G.V)==null||w.postMessage(m)},n9q=function(G,m,w){var W=this;
this.C=G;this.U=m;this.visibility=w;this.j=this.L=this.K=this.X=this.V=!1;this.D=new g.ey(function(){W.N0()});
this.VU={Xe:function(){return W.Y},
N0:function(){W.N0()},
qAM:function(){return W.D}};
this.visibility.subscribe("visibilitystatechange",function(){W.wx()})},xaz=function(G){if(!G.X&&!G.V){var m=la4();
if(m){G.X=!0;var w=g.re("OfflineLockManager");m.request("woffle_orchestration_leader:"+w,{},function(){var W,U;return g.h(function(c){switch(c.Y){case 1:return g.MV(c,2),G.Y=new g.Da,G.V=!0,G.X=!1,g.S(c,G.C(),4);case 4:return g.S(c,G.Y.promise,5);case 5:g.tU(c,0);break;case 2:W=g.fH(c),G.N0(),W instanceof Error&&(U=W,U.args=[{name:"WoLockManagerError",mK:W.name}],g.dR(U)),g.VZ(c)}})})}}},uxq=function(G){G.V&&(G.j=!0,Qk(G))},HaR=function(G,m){G.V&&(G.K=m,Qk(G))},Ylq=function(G,m){G.V&&(G.L=m,Qk(G))},
Qk=function(G){G.L&&G.K&&G.j&&G.visibility.isBackground()?g.nT(G.D,6E4):G.D.stop()},vS=function(G){var m;
G.offlineDeleteReason=(m=G.offlineDeleteReason)!=null?m:"OFFLINE_DELETE_REASON_UNKNOWN";var w;G.offlineModeType=(w=G.offlineModeType)!=null?w:"OFFLINE_NOW";g.U3("offlineDeleteEvent",G)},Dr=function(G,m){var w=m.videoId;
var W=m.xw;m=m.offlineModeType;G.encryptedVideoId=w;G.cotn=W==null?void 0:W.cotn;G.offlineabilityFormatType=W==null?void 0:W.maximumDownloadQuality;var U;G.isRefresh=(U=W==null?void 0:W.isRefresh)!=null?U:!1;var c;G.softErrorCount=(c=W==null?void 0:W.transferRetryCount)!=null?c:0;G.offlineModeType=m!=null?m:"OFFLINE_NOW";(G.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&G.statusType==="UNKNOWN_STATUS_TYPE"||!G.transferStatusType&&!G.statusType)&&g.f4(Error("Woffle unknown transfer status"));
g.U3("offlineTransferStatusChanged",G)},B29=function(G){Dr({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},G)},A39=function(G,m,w,W){W={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!W};m&&w&&(m=Math.floor(m/1024).toFixed(),w=Math.floor(w/1024).toFixed(),W.alreadyDownloadedKbytes=m,W.totalFetchedKbytes=m,W.totalContentKbytes=w);Dr(W,G)},XEm=function(G){Dr({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},G)},y3c=function(G){Dr({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},G)},G6f=function(G){switch(G){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Oi=function(G){var m,w,W;
return((W=(m=G.actionMetadata)==null?void 0:(w=m.retryScheduleIntervalsInSeconds)==null?void 0:w.length)!=null?W:0)>0},qd=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!G.entityKey},TY=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!G.entityKey},$v=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!G.entityKey},mqf=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!G.entityKey},
ak=function(G,m,w,W,U){U=U===void 0?!1:U;
var c,Q,D,O,q,T;return g.h(function(a){if(a.Y==1)return c=g.Yi(G,m),Q=g.Yi(G,"downloadStatusEntity"),g.S(a,BD(w,{mode:"readonly",p5:!0},function(Z){return g.KY.all([Fi(Z,c,m),Fi(Z,Q,"downloadStatusEntity")])}),2);
D=a.V;O=D.length?D[0]:void 0;if(!O)return a.sM(0);q=wvH;if(T=D.length>1?D[1]:void 0){if(T.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!U)return a.return();T.downloadState=W}else T={key:Q,downloadState:W};g.P7(O,q,T);return g.S(a,BD(w,{mode:"readwrite",p5:!0},function(Z){return g.KY.all([xd(Z,O,m),xd(Z,T,"downloadStatusEntity")])}),0)})},Zr=function(G,m){return G.actionType===m.actionType&&G.entityKey===m.entityKey},kv=function(G,m){if(G&&G.transferState!=="TRANSFER_STATE_COMPLETE"&&G.transferState!==
"TRANSFER_STATE_FAILED"){var w=g.Hd(G.key).entityId;
Dr({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:w,xw:G,offlineModeType:m})}},iY=function(G){if(!G||!G.thumbnails)return[];
var m=[];G=g.V(G.thumbnails);for(var w=G.next();!w.done;w=G.next())w=w.value,w.url&&m.push(w.url);return m},W3g=function(G,m,w){w=w===void 0?[]:w;
var W,U,c,Q,D,O,q,T,a,Z,k,K,M;return g.h(function(t){if(t.Y==1)return w.length?g.S(t,yB(G,m),2):t.return([]);W=t.V;U=new Set;c=g.V(W);for(Q=c.next();!Q.done;Q=c.next())if(D=Q.value,O=D.id||D.key)q=g.Hd(O).entityId,U.add(q);T=[];a=g.V(w);for(Z=a.next();!Z.done;Z=a.next())k=Z.value,K=k.offlineVideoData,M=void 0,((M=K)==null?0:M.videoId)&&!U.has(K.videoId)&&T.push(k);return t.return(T)})},Uqz=function(G,m,w){return new g.K_(G,{cotn:m,
raw_player_response:w,download_media:!0,start:Infinity,disable_watch_next:!0})},sic=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},K7=function(G,m,w,W,U,c,Q,D,O,q,T){this.entityType=G;
this.actionId=m;this.action=w;this.parentActionId=W;this.rootActionId=U===void 0?m:U;this.childActionIds=c;this.prereqActionId=Q;this.postreqActionIds=D;this.hasChildActionFailed=q;this.retryScheduleIndex=0;this.V=T||Date.now();this.retryScheduleIndex=O||0},Nd=function(G){if(!G.key)throw Error("Entity key is required.");
if(!G.actionProto)throw Error("OfflineOrchestrationAction is required.");var m=g.Hd(G.key),w=g.Hd(G.actionProto.entityKey);return new K7(w.entityType,m.entityId,G.actionProto,G.parentActionId,G.rootActionId,G.childActionIds,G.prereqActionId,G.postreqActionIds,G.retryScheduleIndex,G.hasChildActionFailed,Number(G.enqueueTimeSec)*1E3)},Ik=function(G){return{key:g.Yi(G.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:G.action,parentActionId:G.parentActionId,rootActionId:G.rootActionId,childActionIds:G.childActionIds,prereqActionId:G.prereqActionId,postreqActionIds:G.postreqActionIds,retryScheduleIndex:G.retryScheduleIndex,hasChildActionFailed:G.hasChildActionFailed,enqueueTimeSec:(G.V/1E3).toFixed()}},cYn=function(){var G;
return g.h(function(m){return m.Y==1?g.S(m,F6H(),2):(G=m.V)?m.return(G.delete("yt-player-local-img")):m.return(!0)})},zY=function(G){var m,w;
return g.h(function(W){if(W.Y==1)return g.S(W,F6H(),2);if(W.Y!=3){m=W.V;if(!m)throw Error("Cache API not supported");return G.length?g.S(W,m.open("yt-player-local-img"),3):W.return()}w=W.V;return g.S(W,Promise.all(G.map(function(U){return w.delete(U)})),0)})},Vk=function(G){var m,w;
return g.h(function(W){if(W.Y==1)return g.S(W,F6H(),2);if(W.Y!=3){m=W.V;if(!m)throw Error("Cache API not supported");return G.length?g.S(W,m.open("yt-player-local-img"),3):W.return()}w=W.V;return g.S(W,w.addAll(G),0)})},Md=function(G,m,w,W,U){var c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF;
return g.h(function(lR){switch(lR.Y){case 1:return c=g.Yi(G,"mainVideoEntity"),Q=g.Yi(G,"ytMainChannelEntity"),D=g.Yi(G,"transfer"),O=g.Yi(G,"videoDownloadContextEntity"),g.S(lR,BD(m,{mode:"readonly",p5:!0},function(nd){return g.KY.all([Fi(nd,c,"mainVideoEntity"),Fi(nd,Q,"ytMainChannelEntity"),Fi(nd,D,"transfer"),Fi(nd,O,"videoDownloadContextEntity"),en(nd,"ytMainChannelEntity"),en(nd,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:q=lR.V;T=g.V(q);a=T.next().value;Z=T.next().value;k=T.next().value;K=T.next().value;M=T.next().value;t=T.next().value;R=a;f=Z;P=k;E=K;e=M;A=t;if(!R&&!f){lR.sM(3);break}Y=R?iY(R.thumbnail):[];if(!f){vW=[];lR.sM(4);break}return g.S(lR,Qif(f,e),5);case 5:vW=lR.V;case 4:return Oo=vW,g.S(lR,zY(Y.concat(Oo)),3);case 3:QZ=[];D$=g.Yi(G,"downloadStatusEntity");me=g.V(A);for(dd=me.next();!dd.done;dd=me.next())Y6=dd.value,Gm=g.Hd(Y6.key).entityId,iR=Nd(Y6),vg=g.Hd(iR.action.entityKey).entityId,Gm!==G&&
vg!==G||Zr(w,Y6.actionProto)||QZ.push(Y6.key);return g.S(lR,BD(m,{mode:"readwrite",p5:!0},function(nd){var vY=QZ.map(function(p){return ur(nd,p)});
vY.push(ur(nd,c,{M4:!0}));vY.push(ur(nd,D$,{M4:!0}));return g.KY.all(vY)}),7);
case 7:QF=(pH=E)==null?void 0:pH.offlineModeType,U&&(vS(U),U.offlineModeType&&(QF=U.offlineModeType)),kv(P,QF),cS(W,{entityKey:c,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.VZ(lR)}})},OTm=function(G,m,w,W){var U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF,lR,nd,vY,p,FK,Sb,WW,bR,L,wd,gQ,vk,rc,uq,wc,wO,eU,b;
return g.h(function(z){switch(z.Y){case 1:return U=g.Yi(G,"mainPlaylistEntity"),c=g.Yi(G,"ytMainChannelEntity"),g.S(z,BD(m,{mode:"readonly",p5:!0},function(d){return g.KY.all([Fi(d,U,"mainPlaylistEntity"),Fi(d,c,"ytMainChannelEntity"),en(d,"mainPlaylistEntity"),en(d,"mainDownloadsListEntity"),en(d,"ytMainChannelEntity"),en(d,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Q=z.V;D=g.V(Q);O=D.next().value;q=D.next().value;T=D.next().value;a=D.next().value;Z=D.next().value;k=D.next().value;K=O;M=q;t=T;R=a;f=Z;P=k;if(!K&&!M){z.sM(3);break}E=K?vEH(K):[];if(!M){e=[];z.sM(4);break}return g.S(z,Qif(M,f),5);case 5:e=z.V;case 4:return A=e,g.S(z,zY(E.concat(A)),3);case 3:Y=[];vW=new Map;if(!K){z.sM(7);break}return g.S(z,Dqq(K,t,R),8);case 8:Y=z.V;Oo=g.V(Y);for(QZ=Oo.next();!QZ.done;QZ=Oo.next())D$=QZ.value,vW.set(D$,{videoId:D$,playlistId:G,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.S(z,BD(m,{mode:"readonly",p5:!0},function(d){return g.KY.all([en(d,"transfer"),en(d,"videoDownloadContextEntity")])}),9);
case 9:me=z.V;dd=g.V(me);Y6=dd.next().value;Gm=dd.next().value;iR=Y6;vg=Gm;pH=g.V(iR);for(QF=pH.next();!QF.done;QF=pH.next())lR=QF.value,nd=g.Hd(lR.key).entityId,(vY=vW.get(nd))&&lR&&(vY.cotn=lR.cotn);p=g.V(vg);for(FK=p.next();!FK.done;FK=p.next())Sb=FK.value,WW=g.Hd(Sb.key).entityId,(bR=vW.get(WW))&&Sb&&(bR.offlineModeType=Sb.offlineModeType);case 7:L=[];wd=g.V(P);for(gQ=wd.next();!gQ.done;gQ=wd.next())vk=gQ.value,rc=g.Hd(vk.key).entityId,uq=Nd(vk),rc!==G&&uq.rootActionId!==G||Zr(w,vk.actionProto)||
L.push(vk.key);wc=g.Yi(G,"mainPlaylistEntity");return g.S(z,BD(m,{mode:"readwrite",p5:!0},function(d){var l=L.map(function(F){return ur(d,F)});
l.push(ur(d,wc,{M4:!0}));return g.KY.all(l)}),10);
case 10:if(!K){z.sM(0);break}Y.reverse();if(!Y){z.sM(0);break}wO=g.V(Y);eU=wO.next();case 13:if(eU.done){z.sM(0);break}b=eU.value;return g.S(z,Md(b,m,w,W,vW.get(b)),14);case 14:eU=wO.next(),z.sM(13)}})},Thz=function(G,m,w,W){var U,c,Q,D,O,q,T,a,Z;
return g.h(function(k){if(k.Y==1)return U=g.Yi("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),c=new Map,g.S(k,BD(G,{mode:"readwrite",p5:!0},function(K){var M=en(K,"transfer"),t=en(K,"offlineOrchestrationActionWrapperEntity"),R=en(K,"videoDownloadContextEntity"),f=Fi(K,U,"mainDownloadsListEntity");return g.KY.all([M,t,R,f]).then(function(P){P=g.V(P);var E=P.next().value;var e=P.next().value;var A=P.next().value;var Y=P.next().value;P=qkc.map(function(Oo){return c3H(K,Oo)});
e=g.V(e);for(var vW=e.next();!vW.done;vW=e.next())vW=vW.value,Zr(m,vW.actionProto)||P.push(ur(K,vW.key,{M4:!0}));Y&&(Y.downloads=[],P.push(xd(K,Y,"mainDownloadsListEntity")));if(A)for(A=g.V(A),Y=A.next();!Y.done;Y=A.next())Y=Y.value,e=g.Hd(Y.key).entityId,e=g.Yi(e,"transfer"),c.set(e,Y.offlineModeType);return g.KY.all(P).then(function(){return E})})}),2);
Q=k.V;D=g.V(Q);for(O=D.next();!O.done;O=D.next())q=O.value,kv(q,c.get(q.key)),T=g.Hd(q.key).entityId,a={videoId:T,offlineDeleteReason:W,cotn:q.cotn,offlineModeType:c.get(q.key)},vS(a),Z=g.Yi(T,"mainVideoEntity"),cS(w,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.S(k,cYn(),0)})},vEH=function(G,m){var w=[];
if(G.thumbnailStyleData){G=g.V(G.thumbnailStyleData);for(var W=G.next();!W.done;W=G.next()){var U=void 0,c=void 0,Q=void 0;w=w.concat(iY((U=W.value)==null?void 0:(c=U.value)==null?void 0:(Q=c.collageThumbnail)==null?void 0:Q.coverThumbnail))}}m=iY(m);return w.concat(m)},Dqq=function(G,m,w){var W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo;
return g.h(function(QZ){W=[];U=new Set;if(w.length)for(c=g.V(w),Q=c.next();!Q.done;Q=c.next())if(D=Q.value,O=void 0,(O=D.downloads)==null?0:O.length)for(q=g.V(D.downloads),T=q.next();!T.done;T=q.next())a=T.value,a.videoItem&&(Z=g.Hd(a.videoItem).entityId,U.add(Z));if(G.videos){k=g.V(G.videos);for(K=k.next();!K.done;K=k.next())M=K.value,t=JSON.parse(g.Hd(M).entityId),t.videoId&&!U.has(t.videoId)&&W.push(t.videoId);R=g.V(m);for(f=R.next();!f.done;f=R.next())if(P=f.value,P.key!==G.key&&(E=P.videos))for(e=
g.V(E),A=e.next();!A.done;A=e.next())Y=A.value,vW=JSON.parse(g.Hd(Y).entityId),vW.videoId&&(Oo=W.indexOf(vW.videoId),Oo!==-1&&W.splice(Oo,1))}return QZ.return(W)})},Qif=function(G,m){var w,W,U,c,Q,D,O,q;
return g.h(function(T){w=iY(G.avatar);W=g.V(m);for(U=W.next();!U.done;U=W.next())if(c=U.value,c.id!==G.id)for(Q=g.V(iY(c.avatar)),D=Q.next();!D.done;D=Q.next())O=D.value,q=w.indexOf(O),q!==-1&&w.splice(q,1);return T.return(w)})},$qb=function(G){var m;
return g.h(function(w){m=g.n(G.frameworkUpdates,L7);return G.frameworkUpdates&&m?g.S(w,N24(m),0):w.return()})},ZTb=function(G){var m;
if((m=G.onResponseReceivedActions)!=null&&m.length){var w;G=(w=g.n(g.n(G.onResponseReceivedActions[0],aKb),g.ILn))==null?void 0:w.actions;if(G!=null&&G.length)return G}},k6q=function(G){var m,w,W;
return g.h(function(U){if(U.Y==1)return G?g.S(U,Xi(G,g.lf,"mainDownloadsListEntity"),2):U.return([]);m=U.V;return((w=m)==null?0:(W=w.downloads)==null?0:W.length)?U.return(m.downloads.map(function(c){var Q;return(Q=c.videoItem)!=null?Q:""})):U.return([])})},K3b=function(G,m){var w;
return g.h(function(W){return W.Y==1?g.S(W,iTR(G,m),2):(w=W.V)?g.S(W,BD(G,{mode:"readwrite",p5:!0},function(U){var c=[xd(U,w.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];w.mainDownloadsListEntity&&c.push(xd(U,w.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.KY.all(c)}),0):W.sM(0)})},iTR=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P;
return g.h(function(E){if(E.Y==1)return w=g.Yi("main_downloads_library_id","mainDownloadsLibraryEntity"),W=g.Yi("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.S(E,BD(G,{mode:"readonly",p5:!0},function(e){return g.KY.all([Fi(e,w,"mainDownloadsLibraryEntity"),Fi(e,W,"mainDownloadsListEntity")])}),2);
U=E.V;c=g.V(U);Q=c.next().value;D=c.next().value;O=Q;q=D;O||(O={id:w});T=g.V(m);for(a=T.next();!a.done;a=T.next())if(Z=a.value,Z===g.lf){if(O.smartDownloadsList)return E.return();O.smartDownloadsList=Z}else if(k=g.Hd(Z).entityType,K={},k==="mainPlaylistEntity"?K.playlistItem=Z:k==="mainVideoEntity"&&(K.videoItem=Z),!g.$u(K)){M=void 0;if((M=q)==null?0:M.downloads){t=!1;R=g.V(q.downloads);for(f=R.next();!f.done;f=R.next())if(P=f.value,P.playlistItem===Z||P.videoItem===Z){t=!0;break}t||q.downloads.push(K)}else q=
{id:W,downloads:[K]};O.downloadsList=W}return E.return({mainDownloadsLibraryEntity:O,mainDownloadsListEntity:q})})},Nhe=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t;
return g.h(function(R){if(R.Y==1)return w=g.Yi("main_downloads_library_id","mainDownloadsLibraryEntity"),W=g.Yi("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.S(R,BD(G,{mode:"readonly",p5:!0},function(f){return g.KY.all([Fi(f,w,"mainDownloadsLibraryEntity"),Fi(f,W,"mainDownloadsListEntity"),Fi(f,g.lf,"mainDownloadsListEntity")])}),2);
U=R.V;c=g.V(U);Q=c.next().value;D=c.next().value;O=c.next().value;q=Q;T=D;a=O;if(!q)return R.sM(0);if(m===g.lf&&((Z=a)==null?0:Z.downloads))a.downloads=[];else if((k=T)==null?0:k.downloads)for(K=g.Hd(m).entityType,M=0;M<T.downloads.length;M++)if(t=T.downloads[M],K==="mainVideoEntity"&&t.videoItem===m){T.downloads.splice(M,1);break}else if(K==="mainPlaylistEntity"&&t.playlistItem===m){T.downloads.splice(M,1);break}return g.S(R,BD(G,{mode:"readwrite",p5:!0},function(f){var P=[xd(f,q,"mainDownloadsLibraryEntity")];
T&&P.push(xd(f,T,"mainDownloadsListEntity"));a&&P.push(xd(f,a,"mainDownloadsListEntity"));return g.KY.all(P)}),0)})},bY=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z;
return g.h(function(k){if(k.Y==1)return w=g.Yi(m,"transfer"),W=g.Yi(m,"videoDownloadContextEntity"),g.S(k,BD(G,{mode:"readonly",p5:!0},function(K){return g.KY.all([Fi(K,w,"transfer"),Fi(K,W,"videoDownloadContextEntity")])}),2);
U=k.V;c=g.V(U);Q=c.next().value;D=c.next().value;O=Q;q=D;Z={videoId:m,cotn:(T=O)==null?void 0:T.cotn,offlineModeType:(a=q)==null?void 0:a.offlineModeType};return k.return(Z)})},tg=function(G,m,w,W,U){var c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW;
return g.h(function(Oo){switch(Oo.Y){case 1:return c=g.Yi(G,"musicTrack"),Q=g.Yi(G,"transfer"),g.S(Oo,BD(m,{mode:"readonly",p5:!0},function(QZ){return g.KY.all([Fi(QZ,c,"musicTrack"),Fi(QZ,Q,"transfer"),en(QZ,"musicTrack"),en(QZ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=Oo.V;O=g.V(D);q=O.next().value;T=O.next().value;a=O.next().value;Z=O.next().value;k=q;K=T;M=a;t=Z;if(!k){Oo.sM(3);break}return g.S(Oo,IKf(k,M),4);case 4:return R=Oo.V,g.S(Oo,zY(R),3);case 3:f=[];P=g.V(t);for(E=P.next();!E.done;E=P.next())e=E.value,A=g.Hd(e.key).entityId,Y=Nd(e),vW=g.Hd(Y.action.entityKey).entityId,A!==G&&vW!==G||Zr(w,e.actionProto)||f.push(e.key);return g.S(Oo,BD(m,{mode:"readwrite",p5:!0},function(QZ){var D$=f.map(function(me){return ur(QZ,me)});
D$.push(ur(QZ,c,{M4:!0}));return g.KY.all(D$)}),6);
case 6:kv(K),U&&vS(U),cS(W,{entityKey:c,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.VZ(Oo)}})},gE=function(G,m,w,W,U){var c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF,lR,nd,vY,p,FK;
return g.h(function(Sb){switch(Sb.Y){case 1:return c=g.Yi(G,m),Q=g.Yi("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(Sb,BD(w,{mode:"readonly",p5:!0},function(WW){return g.KY.all([Fi(WW,c,m),Fi(WW,Q,"musicDownloadsLibraryEntity"),en(WW,m),en(WW,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=Sb.V;O=g.V(D);q=O.next().value;T=O.next().value;a=O.next().value;Z=O.next().value;k=q;K=T;M=a;t=Z;if(!k){Sb.sM(3);break}return g.S(Sb,IKf(k,M),4);case 4:return R=Sb.V,g.S(Sb,zY(R),3);case 3:f=[];P=new Map;if(!k){Sb.sM(6);break}return g.S(Sb,zob(k,M,K),7);case 7:f=Sb.V;E=g.V(f);for(e=E.next();!e.done;e=E.next())A=e.value,Y=g.Hd(A).entityId,P.set(Y,{videoId:Y,playlistId:G,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.S(Sb,yB(w,"transfer"),8);case 8:for(vW=Sb.V,Oo=
g.V(vW),QZ=Oo.next();!QZ.done;QZ=Oo.next())D$=QZ.value,me=g.Hd(D$.key).entityId,(dd=P.get(me))&&D$&&(dd.cotn=D$.cotn);case 6:Y6=[];Gm=g.V(t);for(iR=Gm.next();!iR.done;iR=Gm.next())vg=iR.value,pH=g.Hd(vg.key).entityId,QF=Nd(vg),pH!==G&&QF.rootActionId!==G||Zr(W,vg.actionProto)||Y6.push(vg.key);lR=g.Yi(G,m);return g.S(Sb,BD(w,{mode:"readwrite",p5:!0},function(WW){var bR=Y6.map(function(L){return ur(WW,L)});
bR.push(ur(WW,lR,{M4:!0}));return g.KY.all(bR)}),9);
case 9:if(!k){Sb.sM(0);break}f.reverse();if(!f.length){Sb.sM(0);break}nd=g.V(f);vY=nd.next();case 12:if(vY.done){Sb.sM(0);break}p=vY.value;FK=g.Hd(p).entityId;if(!FK){Sb.sM(13);break}return g.S(Sb,tg(FK,w,W,U,P.get(FK)),13);case 13:vY=nd.next(),Sb.sM(12)}})},dE=function(G,m,w){var W,U,c,Q,D,O,q;
return g.h(function(T){if(T.Y==1)return g.S(T,BD(G,{mode:"readwrite",p5:!0},function(a){var Z=en(a,"transfer"),k=en(a,"offlineOrchestrationActionWrapperEntity");return g.KY.all([Z,k]).then(function(K){K=g.V(K);var M=K.next().value;var t=K.next().value;K=Vyb.map(function(E){return c3H(a,E)});
t=g.V(t);for(var R=t.next();!R.done;R=t.next()){R=R.value;var f=g.Hd(R.actionProto.entityKey).entityType==="musicTrack",P=R.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Zr(m,R.actionProto)||f&&(!f||P)||K.push(ur(a,R.key,{M4:!0}))}return g.KY.all(K).then(function(){return M})})}),2);
W=T.V;U=g.V(W);for(c=U.next();!c.done;c=U.next())Q=c.value,kv(Q),D=g.Hd(Q.key).entityId,O={videoId:D,offlineDeleteReason:void 0,cotn:Q.cotn},vS(O),q=g.Yi(D,"musicTrack"),cS(w,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.S(T,cYn(),0)})},MyR=function(G){for(var m,w=g.V(G.additionalMetadatas),W=w.next();!W.done;W=w.next())W=W.value,W.offlineMusicVideoData&&(m=W.offlineMusicVideoData);
var U,c,Q,D,O;return{id:g.Yi(G.videoId,"musicTrack"),videoId:G.videoId,title:G.title,thumbnailDetails:G.thumbnail,lengthMs:String(Number(G.lengthSeconds)*1E3),albumTitle:(U=m)==null?void 0:U.releaseTitle,musicVideoType:(c=m)==null?void 0:c.musicVideoType,contentRating:{explicitType:(Q=m)==null?void 0:Q.explicitType},artistNames:((D=m)==null?void 0:D.byline)||((O=m)==null?void 0:O.channelName),downloadMetadata:g.Yi(G.videoId,"musicTrackDownloadMetadataEntity")}},zob=function(G,m,w){var W,U,c,Q,D,O,
q,T,a,Z,k,K,M,t,R,f,P,E;
return g.h(function(e){W=[];U=new Set;if((c=w)==null?0:(Q=c.downloadedTracks)==null?0:Q.length)for(D=g.V(w.downloadedTracks),O=D.next();!O.done;O=D.next())q=O.value,U.add(q);if(G.tracks){T=g.V(G.tracks);for(a=T.next();!a.done;a=T.next())Z=a.value,U.has(Z)||W.push(Z);k=g.V(m);for(K=k.next();!K.done;K=k.next())if(M=K.value,M.id!==G.id&&(t=M.tracks))for(R=g.V(t),f=R.next();!f.done;f=R.next())P=f.value,E=W.indexOf(P),E!==-1&&W.splice(E,1)}return e.return(W)})},IKf=function(G,m){var w,W,U,c,Q,D,O,q;
return g.h(function(T){w=iY(G.thumbnailDetails);W=g.V(m);for(U=W.next();!U.done;U=W.next())if(c=U.value,c.id!==G.id)for(Q=g.V(iY(c.thumbnailDetails)),D=Q.next();!D.done;D=Q.next())O=D.value,q=w.indexOf(O),q!==-1&&w.splice(q,1);return T.return(w)})},L3R=function(G,m){var w,W,U,c,Q,D,O,q,T;
return g.h(function(a){if(a.Y==1)return w=g.Yi("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(a,Xi(G,w,"musicDownloadsLibraryEntity"),2);(W=a.V)||(W={id:w});U=g.Hd(m).entityType;U==="musicTrack"?(c=W.downloadedTracks)!=null&&c.includes(m)||(W.downloadedTracks=((Q=W.downloadedTracks)!=null?Q:[]).concat(m)):U==="musicPlaylist"?(D=W.downloadedPlaylists)!=null&&D.includes(m)||(W.downloadedPlaylists=((O=W.downloadedPlaylists)!=null?O:[]).concat(m)):U!=="musicAlbumRelease"||(q=W.downloadedAlbumReleases)!=
null&&q.includes(m)||(W.downloadedAlbumReleases=((T=W.downloadedAlbumReleases)!=null?T:[]).concat(m));return g.S(a,AR(G,W,"musicDownloadsLibraryEntity"),0)})},bTq=function(G,m){var w,W,U,c,Q,D,O;
return g.h(function(q){if(q.Y==1)return w=g.Yi("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(q,Xi(G,w,"musicDownloadsLibraryEntity"),2);W=q.V;if(!W)return q.sM(0);U=g.Hd(m).entityType;U==="musicTrack"?c=W.downloadedTracks:U==="musicPlaylist"&&(c=W.downloadedPlaylists);if((Q=c)==null?0:Q.length)for(D=0;D<c.length;D++)if(O=c[D],O===m){c.splice(D,1);break}return g.S(q,AR(G,W,"musicDownloadsLibraryEntity"),0)})},tyf=function(G){var m=G.videos;
G=[];var w=[];if(m){m=g.V(m);for(var W=m.next();!W.done;W=m.next()){var U=W.value.offlineVideoData.videoId;W=g.Yi(U,"musicTrack");U=g.Yi(U,"musicTrackDownloadMetadataEntity");G.push(W);w.push(U)}}return{hq:G,bV:w}},f7=function(G,m,w){m={track:MyR(m)};
w&&(m.playlistId=w);if(G=g.n(G.actionMetadata,gEq))m.maximumDownloadQuality=G.maximumDownloadQuality;return{musicTrackEntityActionMetadata:m}},fKn=function(G){var m,w,W,U,c,Q,D,O;
return g.h(function(q){switch(q.Y){case 1:return m=g.n8(),w=g9z(G),W=g.AI(dqd),g.MV(q,2),c={mJ:!0},g.S(q,g.Se(m,w,W,void 0,c),4);case 4:U=q.V;g.tU(q,3);break;case 2:Q=g.fH(q);if(Q instanceof g.r1)throw D="GetOffline network manager error: "+Q.message,Ui(D,Q),Error(D);Ui("GetOffline fetch request error",Q);throw Error("GetOffline fetch request error");case 3:O=Rk(U);if(!U)throw Ui("Network request failed"),Error("Network request failed");if(O!==void 0)p7(O);else if(!U.videos||!U.videos.length)throw Ui("No data"),
Error("No data");return q.return(U.videos.map(function(T){return T.offlineVideoData}))}})},Ro4=function(G){var m,w,W,U,c,Q,D,O;
return g.h(function(q){switch(q.Y){case 1:return m=g.n8(),w=dad(G),W=g.AI(dqd),g.MV(q,2),c={mJ:!0},g.S(q,g.Se(m,w,W,void 0,c),4);case 4:U=q.V;g.tU(q,3);break;case 2:Q=g.fH(q);if(Q instanceof g.r1)throw D="GetOffline network manager error for playlist: "+Q.message,Ui(D,Q),Error(D);Ui("GetOffline fetch request error for playlist",Q);throw Error("GetOffline fetch request error for playlist");case 3:O=Rk(U);if(!U)throw Ui("Network request failed for playlist"),Error("Network request failed for playlist");
if(O!==void 0)p7(O,"playlist");else if(!U.playlists||!U.playlists.length)throw Ui("No data for playlist"),Error("No data for playlist");return q.return(U.playlists.map(function(T){return T.offlinePlaylistData}))}})},jib=function(G,m,w,W){var U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg;
return g.h(function(pH){switch(pH.Y){case 1:return g.S(pH,GY(),2);case 2:U=pH.V;if(!U)return pH.return([]);c=[];if((Q=W)==null?0:Q.length){c=W;pH.sM(3);break}return g.S(pH,yB(U,"mainPlaylistEntity"),4);case 4:c=pH.V;case 3:if(!c.length)return pH.return([]);D=[];O=Date.now()/1E3;q=g.V(c);T=q.next();case 5:if(T.done)return D.length?g.S(pH,pvn(D),10):pH.return([]);a=T.value;if(!a.downloadState){Z=void 0;pH.sM(8);break}return g.S(pH,Xi(U,a.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:Z=
pH.V;case 8:k=Z;K=void 0;t=(M=(K=a)==null?void 0:K.entityMetadata)&&M.nextAutoRefreshIntervalSeconds?Number(M.nextAutoRefreshIntervalSeconds):NaN;R=Number.isNaN(t)?G:t;P=f=void 0;E=((f=k)==null?0:f.lastSyncedTimestampMillis)?Number((P=k)==null?void 0:P.lastSyncedTimestampMillis)/1E3:0;A=e=void 0;Y=((e=k)==null?0:e.addedTimestampMillis)?Number((A=k)==null?void 0:A.addedTimestampMillis)/1E3:0;if(w||!M||E+R<=O){vW=[];Oo=void 0;if((Oo=a.videos)==null?0:Oo.length)for(QZ=g.V(a.videos),D$=QZ.next();!D$.done;D$=
QZ.next())me=D$.value,dd=JSON.parse(g.Hd(me).entityId),dd.videoId&&vW.push(dd.videoId);Y6="0";M&&(Gm=void 0,Y6=String(Number((Gm=M.offlineLastModifiedTimestampSeconds)!=null?Gm:0).toFixed()));iR={playlistId:a.playlistId,videoIds:vW,offlineLastModifiedTimestamp:Y6,autoSync:m,offlineDateAddedTimestamp:String(Y.toFixed())};D.push(iR)}T=q.next();pH.sM(5);break;case 10:return vg=pH.V,pH.return(vg)}})},Skd=function(){var G,m,w,W,U;
return g.h(function(c){if(c.Y==1)return g.S(c,GY(),2);if(c.Y!=3)return(G=c.V)?g.S(c,yB(G,"refresh"),3):c.return(!1);m=c.V;if((w=m[0])==null||!w.refreshTime)return c.return(!1);W=Number(m[0].refreshTime);U=Date.now()/1E3;return c.return(isFinite(W)&&U>=W)})},oEz=function(G,m){var w,W,U;
return g.h(function(c){switch(c.Y){case 1:return g.MV(c,2),g.S(c,P3e(G,m),4);case 4:return W=c.V,g.S(c,$qb(W),5);case 5:w=ZTb(W);g.tU(c,3);break;case 2:U=g.fH(c),Ui("getAndProcessSmartDownloadsResponse request or processing error",U);case 3:return c.return(w)}})},hom=function(G,m,w,W){var U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg;
return g.h(function(pH){switch(pH.Y){case 1:return g.S(pH,GY(),2);case 2:U=pH.V;if(!U)return pH.return([]);c=[];if((Q=W)==null?0:Q.length){c=W;pH.sM(3);break}return g.S(pH,yB(U,"musicPlaylist"),4);case 4:c=pH.V;case 3:if(!c.length)return pH.return([]);D=[];O=Date.now()/1E3;q=g.V(c);T=q.next();case 5:if(T.done)return D.length?g.S(pH,pvn(D),10):pH.return([]);a=T.value;Z=void 0;K=(k=(Z=a)==null?void 0:Z.entityMetadata)&&k.nextAutoRefreshIntervalSeconds?Number(k.nextAutoRefreshIntervalSeconds):NaN;M=
Number.isNaN(K)?G:K;R=t=0;f="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!a.downloadMetadata){pH.sM(8);break}return g.S(pH,Xi(U,a.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:P=pH.V,e=E=void 0,t=Number((e=(E=P)==null?void 0:E.addedTimestampMillis)!=null?e:"0")/1E3,Y=A=void 0,R=Number((Y=(A=P)==null?void 0:A.lastModifiedTimestampMillis)!=null?Y:"0")/1E3,Oo=vW=void 0,f=(Oo=(vW=P)==null?void 0:vW.syncState)!=null?Oo:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:QZ=void 0;if(w||f!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!k||Number((QZ=k.lastSyncedTimestampSeconds)!=null?QZ:0)+M<=O){D$=[];me=void 0;if((me=a.tracks)==null?0:me.length)for(dd=g.V(a.tracks),Y6=dd.next();!Y6.done;Y6=dd.next())Gm=Y6.value,D$.push(g.Hd(Gm).entityId);iR={playlistId:a.playlistId,videoIds:D$,offlineLastModifiedTimestamp:String(R.toFixed()),autoSync:m,offlineDateAddedTimestamp:String(t.toFixed())};D.push(iR)}T=q.next();pH.sM(5);break;case 10:return vg=pH.V,pH.return(vg)}})},P3e=function(G,m){var w,W,U,c,Q,D,O,q,T,a;
return g.h(function(Z){switch(Z.Y){case 1:return w=g.n8(),g.S(Z,GY(),2);case 2:W=Z.V;if(!W){Z.sM(3);break}return g.S(Z,o99(W),4);case 4:U=Z.V;case 3:var k=U;c={context:g.HZ(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:G},offlineClientState:k,clientStateRequestData:{preferredFormatType:m}}}};Q=g.AI(lKc);g.MV(Z,5);O={mJ:!0};return g.S(Z,g.Se(w,c,Q,void 0,O),7);case 7:D=Z.V;g.tU(Z,6);break;case 5:q=g.fH(Z);if(q instanceof g.r1)throw T=
"DPS network manager error for smart downloads: "+q.message,Ui(T,q),Error(T);Ui("DPS fetch request error for smart downloads",q);throw Error("DPS fetch request error for smart downloads");case 6:a=Rk(D);if(D)a!==void 0&&p7(a,"smart downloads");else throw Ui("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return Z.return(D)}})},EEg=function(G,m){var w,W,U,c,Q,D,O,q;
return g.h(function(T){switch(T.Y){case 1:return w=g.n8(),W={context:g.HZ(),videoPlaybackPositionEntities:G,lastSyncTimestampUsec:m},U=g.AI(C3c),g.MV(T,2),Q={mJ:!0},g.S(T,g.Se(w,W,U,void 0,Q),4);case 4:c=T.V;g.tU(T,3);break;case 2:D=g.fH(T);if(D instanceof g.r1)throw O="VPPS network manager error: "+D.message,Ui(O,D),Error(O);Ui("VPPS fetch request error",D);throw Error("VPPS fetch request error");case 3:q=Rk(c);if(c)q!==void 0&&p7(q,"position sync");else throw Ui("Network request failed for position sync"),
Error("Network request failed for position sync");return T.return(c)}})},rYc=function(G,m,w){var W,U,c,Q,D,O,q,T;
return g.h(function(a){switch(a.Y){case 1:W=g.n8();var Z=w.refreshData,k=w.isEnqueuedForExpiredStreamUrlRefetch,K=w.o0,M=w.offlineSourceData,t=w.mediaCapabilities,R={entityKey:G};Z&&(R.refreshData=Z);k&&(R.isExpiredStreamUrlRefetch=k);K&&(R.downloadParameters=K);M&&(R.offlineSourceData=M);Z={context:g.LB(m),signatureTimestamp:20307,videos:[R]};t&&(Z.mediaCapabilities=t);U=Z;c=g.AI(JYm);g.MV(a,2);D={mJ:!0};return g.S(a,g.Se(W,U,c,void 0,D),4);case 4:Q=a.V;g.tU(a,3);break;case 2:O=g.fH(a);if(O instanceof
g.r1)throw q="GetPDE network manager error: "+O.message,Ui(q,O),Error(q);Ui("GetPDE fetch request error",O);throw Error("GetPDE fetch request error");case 3:T=Rk(Q);if(Q)T!==void 0&&p7(T,"PDE");else throw Ui("Network request failed for PDE"),Error("Network request failed for PDE");return a.return(Q)}})},Rk=function(G){var m;
return(m=G.errorMetadata)==null?void 0:m.status},p7=function(G,m){m=m?" for "+m:"";
if(G===0)throw G="Empty response body"+m,Ui(G),Error(G);G="Response with error"+m;Ui(G);throw Error(G);},pvn=function(G){var m,w,W,U,c,Q,D,O;
return g.h(function(q){switch(q.Y){case 1:return m=g.n8(),w=faz(G),W=g.AI(F3m),g.MV(q,2),c={mJ:!0},g.S(q,g.Se(m,w,W,void 0,c),4);case 4:U=q.V;g.tU(q,3);break;case 2:Q=g.fH(q);if(Q instanceof g.r1)throw D="offlinePlaylistSyncCheck network manager error: "+Q.message,Ui(D,Q),Error(D);Ui("offlinePlaylistSyncCheck fetch request error",Q);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:O=Rk(U);if(!U)throw Ui("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(O!==void 0)p7(O,"playlist sync");else if(!U.offlinePlaylistSyncCheckDatas||!U.offlinePlaylistSyncCheckDatas.length)throw Ui("No data for playlist sync"),Error("No data for playlist sync");return q.return(U.offlinePlaylistSyncCheckDatas.map(function(T){return T.offlinePlaylistSyncCheckData}))}})},jt=function(G){this.V=G},eoe=function(G,m){var w,W,U,c,Q,D;
return g.h(function(O){switch(O.Y){case 1:w=new Map,W=g.V(m),U=W.next();case 2:if(U.done){O.sM(4);break}c=U.value;Q=w;D=Q.set;return g.S(O,G.Y(c),5);case 5:D.call(Q,c,O.V);U=W.next();O.sM(2);break;case 4:return O.return(w)}})},St=function(G,m,w,W,U,c){m=g.Yi(m,w);
W=Object.assign({},c,{priority:W,retryScheduleIntervalsInSeconds:U});return{actionType:G,entityKey:m,actionMetadata:W}},PS=function(G,m,w,W,U,c){this.status=G;
this.V=m;this.D=w;this.Y=W;this.X=U;this.downloadState=c},nEq=function(G,m,w){this.V=G;
this.h4=m;this.X=w},HTg=function(G,m){var w,W,U,c,Q,D,O,q,T;
return g.h(function(a){switch(a.Y){case 1:return w=m.entityKey,U=(W=g.n(m.actionMetadata,ok))==null?void 0:W.isEnqueuedForExpiredStreamUrlRefetch,g.MV(a,2),c=void 0,g.S(a,xqz(G,m),4);case 4:c=a.V;g.MV(a,5);var Z=(Z=g.n(m.actionMetadata,ok))?{maximumDownloadQuality:Z.maximumDownloadQuality}:void 0;return g.S(a,rYc(w,G.h4,{isEnqueuedForExpiredStreamUrlRefetch:U,o0:Z,offlineSourceData:c}),7);case 7:Q=a.V;g.tU(a,6,2);break;case 5:return g.fH(a,2),D=Oi(m)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Ui("PDE handleAdd error"),a.return(hg(m,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,"DOWNLOAD_STATE_FAILED"));case 6:return g.S(a,uUn(G,Q,m),8);case 8:return a.return(hg(m,!0,Q.orchestrationActions));case 2:return O=g.fH(a),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.qD&&O.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ui("PDE handleAdd error"),a.return(hg(m,!1,void 0,q,T,"DOWNLOAD_STATE_FAILED"))}})},AYR=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo;
return g.h(function(QZ){switch(QZ.Y){case 1:return w=m.entityKey,W=g.Hd(w).entityId,g.S(QZ,BD(G.V,{mode:"readonly",p5:!0},function(D$){var me=Fi(D$,w,"playbackData"),dd=Fi(D$,g.Yi(W,"offlineVideoPolicy"),"offlineVideoPolicy");D$=Fi(D$,g.Yi(W,"transfer"),"transfer");return g.KY.all([me,dd,D$])}),2);
case 2:U=QZ.V;c=g.V(U);Q=c.next().value;D=c.next().value;O=c.next().value;q=Q;T=D;a=O;if(!q||!T)return QZ.return(hg(m,!0));Z=[];M=((K=q)==null?0:K.playerResponseJson)?JSON.parse(q.playerResponseJson):null;if(!(a&&M&&G.h4.J("html5_refresh_deprecated_downloads"))){QZ.sM(3);break}k=Yk4(G,M,a);return g.S(QZ,BhH(G,a),4);case 4:Z=QZ.V;case 3:t={lastPlayerResponseTimestampSeconds:q.playerResponseTimestamp,offlineToken:T.offlineToken,formatIds:Z};R={};if((f=a)==null?0:f.maximumDownloadQuality)R.maximumDownloadQuality=
a.maximumDownloadQuality;g.MV(QZ,5);P=void 0;return g.S(QZ,xqz(G,m),7);case 7:return P=QZ.V,g.MV(QZ,8),g.S(QZ,rYc(w,G.h4,{refreshData:t,o0:R,offlineSourceData:P,mediaCapabilities:k}),10);case 10:E=QZ.V;g.tU(QZ,9,5);break;case 8:return g.fH(QZ,5),e=Oi(m)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Ui("PDE handleRefresh error"),QZ.return(hg(m,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",e,
"DOWNLOAD_STATE_FAILED"));case 9:return g.S(QZ,uUn(G,E,m),11);case 11:return QZ.return(hg(m,!0,E.orchestrationActions));case 5:return A=g.fH(QZ),Y="PDE handleRefresh error",A instanceof Error&&(Y="PDE handleRefresh error: "+A.message),vW="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Oo="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",A instanceof g.qD&&A.type==="QUOTA_EXCEEDED"&&(vW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Oo="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Ui(Y),QZ.return(hg(m,!1,void 0,vW,Oo,"DOWNLOAD_STATE_FAILED"))}})},xqz=function(G,m){var w,W,U,c;
return g.h(function(Q){if(Q.Y==1)return w=g.Hd(m.entityKey).entityId,W=g.Yi(w,"videoDownloadContextEntity"),g.S(Q,Xi(G.V,W,"videoDownloadContextEntity"),2);U=Q.V;return(c=U)!=null&&c.offlineModeType?Q.return({offlineModeType:U.offlineModeType}):Q.return(void 0)})},uUn=function(G,m,w){var W,U,c,Q,D;
return g.h(function(O){if(O.Y==1){if(!m.frameworkUpdates||!g.n(m.frameworkUpdates,L7))return O.return();if(!(g.n(m.frameworkUpdates,L7).mutations&&g.n(m.frameworkUpdates,L7).mutations.length>0&&g.n(m.frameworkUpdates,L7).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return O.sM(2);W=g.Hd(g.n(m.frameworkUpdates,L7).mutations[0].entityKey).entityId;return g.S(O,bY(G.V,W),3)}if(O.Y!=2){U=O.V;c=g.n(w.actionMetadata,ok);if(D=(Q=c)==null?void 0:Q.playlistId)U.playlistId=D;U.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Mu(G.h4)?g.S(O,Md(W,G.V,w,G.X,U),2):g.SX(G.h4)?g.S(O,tg(W,G.V,w,G.X),2):O.sM(2)}return g.S(O,N24(g.n(m.frameworkUpdates,L7)),0)})},hg=function(G,m,w,W,U,c){return new PS(m?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Oi(G),w,W,U,c)},Yk4=function(G,m,w){m=Uqz(G.h4,w.cotn,m);
w=g.P9(m);return g.V7e(m,w,G.h4)},BhH=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z;
return g.h(function(k){if(k.Y==1)return w=[],g.S(k,BD(G.V,{mode:"readonly",p5:!0},function(K){var M=[],t=m.offlineVideoStreams;if(t){t=g.V(t);for(var R=t.next();!R.done;R=t.next())M.push(Fi(K,R.value,"offlineVideoStreams"))}return g.KY.all(M)}),2);
if(W=k.V)for(U=g.V(W),c=U.next();!c.done;c=U.next())if(Q=c.value,D=void 0,(D=Q)==null?0:D.streamsProgress)for(O=Q.streamsProgress,q=0;q<O.length;q++)T=O[q],a=JSON.parse(T.formatStreamBytes),Z={itag:a.itag,lmt:a.lastModified,xtags:a.xtags},w.push(Z);return k.return(w)})},XvH=function(G,m){this.V=G;
this.h4=m},yYe=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k;
return g.h(function(K){switch(K.Y){case 1:return w=Oi(m),g.S(K,yB(G.V,"videoPlaybackPositionEntity"),2);case 2:W=K.V;if(W.length===0)return K.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.MV(K,3);return g.S(K,EM.getInstance(),5);case 5:U=K.V;if(!U)throw Error("prefStorage is undefined");return g.S(K,U.get("psi"),6);case 6:return c=K.V,O=(D=(Q=c)==null?void 0:Q.S_)!=null?D:"0",g.S(K,EEg(W,O),7);case 7:return q=K.V,T={isPaused:q.watchHistoryPaused,S_:q.syncTimestampUsec},g.S(K,U.set("psi",
T),8);case 8:if(T.isPaused){K.sM(9);break}a=g.n(q.frameworkUpdates,L7);if(!q.frameworkUpdates||!a){K.sM(9);break}return g.S(K,N24(a),9);case 9:g.tU(K,4);break;case 3:return Z=g.fH(K),k="PPE handleRefresh error: "+(Z instanceof Error?Z.message:"unknown error"),Ui(k),K.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return K.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},mSn=function(G,m){var w,W,U,c,Q,D,O,q;
return g.h(function(T){switch(T.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey).entityId,g.MV(T,2),g.S(T,EM.getInstance(),4);case 4:U=T.V;if(!U)throw Error("prefStorage is undefined");return g.S(T,U.get("psi"),5);case 5:c=T.V;Q=g.n(m.actionMetadata,Gbz);if(((D=c)==null?void 0:D.isPaused)!==!1||(O=Q)==null||!O.lastPlaybackPositionSeconds){T.sM(6);break}q={key:g.Yi(W,"videoPlaybackPositionEntity"),videoId:W,lastPlaybackPositionSeconds:Q.lastPlaybackPositionSeconds};return g.S(T,AR(G.V,q,"videoPlaybackPositionEntity"),
6);case 6:g.tU(T,3);break;case 2:return g.fH(T),T.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},wjH=function(G,m){var w,W,U;
return g.h(function(c){switch(c.Y){case 1:w=Oi(m);g.MV(c,2);W=g.Hd(m.entityKey).entityId;if(W==="!*$_ALL_ENTITIES_!*$")return g.S(c,aaR(G.V),5);U=g.Yi(W,"videoPlaybackPositionEntity");return g.S(c,$ac(G.V,U),5);case 5:g.tU(c,3);break;case 2:return g.fH(c),c.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},WB9=function(G,m){this.api=G;
this.V=m;this.logger=new g.MX("woffle");this.Y=!1;this.VU={sO:this.sO};this.logger.debug("Initialized OfflineMediaManager")},USH=function(G){return g.h(function(m){return m.return(t_H(G))})},sMf=function(G){var m;
return g.h(function(w){if(w.Y==1)return g.S(w,g.FbB(G),2);m=w.V;return w.return(m.filter(function(W){return!!W.url}).map(function(W){return W.url}))})},lY=function(G,m){var w=g.U8(m);
if(w===1||w===0)return Promise.resolve();(w=cpd(G,m))&&w.stopVideo();G.X=0;return USH(m)},C7=function(G,m,w,W){w=w===void 0?!1:w;
W=W===void 0?!0:W;var U=typeof m==="string"?m:m.videoDetails.videoId;g.U8(U)===2&&((m=cpd(G,U))?m.stopVideo():G.logger.info(function(){return"Corresponding player for "+U+" not found. Pausing anyway"}),g.s8(U,2),G.X=2,w?QMb(G.V):W&&vjq(G.V))},cpd=function(G,m){var w;
return((w=G.player)==null?void 0:w.getVideoData().videoId)===m?G.player:null},DSn=function(G,m,w){m.getPlayerResponse();
g.s8(m.videoId,2);G.X=2;G.Y=!1;var W;(W=G.player)==null||W.dispose();G.player=G.api.Xr(m);m={};G.player.HF((m.localmediachange=G.f1,m.signatureexpired=G.TV,m.statechange=G.H56,m),G);G.J("html5_generate_content_po_token")&&G.player.Zk();var U=G.sO(w);G.player.Nf(g.RK(U,U,!0,"m"),!1);G.logger.debug(function(){return"Starting headless playback with quality: "+U});
G.player.gD(!1)},OGR=function(G,m){this.V=G;
this.h4=m},TVH=function(G,m){var w,W;
return g.h(function(U){switch(U.Y){case 1:return w=Oi(m),g.S(U,Xi(G.V,m.entityKey,"transfer"),2);case 2:if(W=U.V)return U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.MV(U,3);return g.S(U,qNg(G,m),5);case 5:g.tU(U,4);break;case 3:return g.fH(U),U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},$Sq=function(G,m){var w,W;
return g.h(function(U){switch(U.Y){case 1:return w=Oi(m),g.S(U,Xi(G.V,m.entityKey,"transfer"),2);case 2:W=U.V;if(!W||W.transferState!=="TRANSFER_STATE_COMPLETE")return U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.MV(U,3);return g.S(U,qNg(G,m,!0),5);case 5:g.tU(U,4);break;case 3:return g.fH(U),U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},aw4=function(G,m){var w,W,U,c,Q,D,O,q,T,a;
return g.h(function(Z){switch(Z.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey).entityId,g.S(Z,BD(G.V,{mode:"readonly",p5:!0},function(k){var K=Fi(k,m.entityKey,"transfer");k=Fi(k,g.Yi(W,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.KY.all([K,k])}),2);
case 2:U=Z.V;c=g.V(U);Q=c.next().value;D=c.next().value;O=Q;q=D;if(!O||O.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return Z.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.MV(Z,3);O.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.S(Z,AR(G.V,O,"transfer"),5);case 5:T=g.Hd(O.key).entityId;XEm({videoId:T,xw:O,offlineModeType:(a=q)==null?void 0:a.offlineModeType});g.tU(Z,4);break;case 3:return g.fH(Z),Z.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Z.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},qNg=function(G,m,w){w=w===void 0?!1:w;
var W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R;return g.h(function(f){switch(f.Y){case 1:return W=g.n(m.actionMetadata,ZGg),U=g.Hd(m.entityKey).entityId,c=g.Yi(U,"downloadStatusEntity"),g.S(f,BD(G.V,{mode:"readonly",p5:!0},function(P){var E=Fi(P,c,"downloadStatusEntity");P=Fi(P,g.Yi(U,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.KY.all([E,P])}),2);
case 2:return Q=f.V,D=g.V(Q),O=D.next().value,q=D.next().value,T=O,a=q,Z="TRANSFER_STATE_TRANSFER_IN_QUEUE",((k=T)==null?void 0:k.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(Z="TRANSFER_STATE_PAUSED_BY_USER"),t={key:m.entityKey,transferState:Z,cotn:g.iy(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(K=W)==null?void 0:K.maximumDownloadQuality,preferredAudioTrack:(M=W)==null?void 0:M.preferredAudioTrack,transferRetryCount:0,isRefresh:w,hasLoggedFirstStarted:!1},g.S(f,BD(G.V,
{mode:"readwrite",p5:!0},function(P){var E=[];w&&E.push(ur(P,g.Yi(U,"offlineVideoStreams")));E.push(xd(P,t,"transfer"));return g.KY.all(E)}),3);
case 3:if(!w){f.sM(4);break}return g.S(f,USH(U),4);case 4:B29({videoId:U,xw:t,offlineModeType:(R=a)==null?void 0:R.offlineModeType}),g.VZ(f)}})},iG9=function(G,m,w,W){if(!G.action.entityKey)throw Error("entityKey is missing.");
var U=g.Hd(G.action.entityKey);U={entityType:U.LK,entityId:U.entityId,offlineOrchestrationActionType:G.action.actionType,orchestrationAction:{orchestrationActionId:G.actionId}};m&&(U.offlineOrchestrationActionResult=m.status,U.isRetryable=w?!1:m.V,m.X&&(U.offlineOrchestrationFailureReason=kbd(m.X,U.isRetryable)));var c,Q;if((c=G.action.actionMetadata)==null?0:(Q=c.offlineLoggingData)==null?0:Q.offlineModeType)U.offlineModeType=G.action.actionMetadata.offlineLoggingData.offlineModeType;W&&(U.additionalOrchestrationActions=
W.map(function(D){return{orchestrationActionId:D.actionId}}));
return U},kbd=function(G,m){return G!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||m?G==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&m?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":G:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},KBH=function(G,m){var w={offlineOrchestrationContext:iG9(G)};
m=SlH(m,w);Pcc(j2g(),m,G.rootActionId)},NVe=function(G,m,w,W){W=W===void 0?[]:W;
m={offlineOrchestrationContext:iG9(G,m,w,W)};m=SlH(3,m);Pcc(j2g(),m,G.rootActionId)},IwR=function(){this.actions=[]},znd=function(G,m){m=g.V(m);
for(var w=m.next();!w.done;w=m.next())w=w.value,KBH(w,1),G.actions.push(w);G.actions.sort(G.V)},VA4=function(G,m){if(m)for(var w=0;w<G.actions.length;w++)if(m==="!*$_ALL_ENTITIES_!*$"&&G.actions[w].actionId!==m||m!=="!*$_ALL_ENTITIES_!*$"&&G.actions[w].rootActionId===m&&G.actions[w].actionId!==m)G.actions.splice(w,1),w--},MAH=function(G,m){G=g.V(G.actions);
for(var w=G.next();!w.done;w=G.next())if(w.value.actionId===m)return!0;return!1},Ei=function(G,m,w,W,U){g.J.call(this);
var c=this;this.Y=G;this.M9=m;this.YB=w;this.L=W;this.h4=U;this.V=new IwR;this.K=new g.rA;this.X=new g.ey(function(){c.retry()});
this.C=NaN;this.j=!1;this.VU={eD2:function(){return c.V},
aD:function(){return c.K},
Tu6:function(){return c.X},
retry:function(){return c.retry()}};
g.r(this,this.X);this.U=this.Y.observe(this.D6.bind(this))},tAq=function(G,m,w,W,U){var c;
return g.h(function(Q){if(Q.Y==1)return c=new Ei(G,m,w,W,U),g.S(Q,LBb(c),2);bGq(c);return Q.return(c)})},bGq=function(G){var m=G.V.actions[0];
return G.D?((m==null?void 0:m.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&G.D[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(G.j=!0),Promise.resolve()):gje(G)},gje=function(G){var m,w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R;
return g.h(function(f){switch(f.Y){case 1:if(G.D)throw Error("Already processing an action");if(G.i6())return f.return();m=G.V.actions.shift();HaR(G.YB,!m);if(m===void 0)return f.return();m.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&m.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&VA4(G.V,m.actionId);w="";m.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&m.rootActionId===m.actionId&&(w=m.actionId);W=[m];G.D=W;if(U=G.M9[m.entityType]){f.sM(2);break}G.D=
void 0;return g.S(f,gje(G),3);case 3:return f.return();case 2:c=g.V(W);for(Q=c.next();!Q.done;Q=c.next())D=Q.value,KBH(D,2);g.MV(f,4,5);return g.S(f,eoe(U,W.map(function(P){return P.action})),7);
case 7:O=f.V,q=g.V(W),T=q.next();case 8:if(T.done){f.sM(10);break}a=T.value;Z=O.get(a.action);return g.S(f,dSd(G,a,Z),9);case 9:T=q.next();f.sM(8);break;case 10:VA4(G.V,w);case 5:g.SV(f);G.D=void 0;g.o9(f,6);break;case 4:return k=g.fH(f),Ui("Orchestration error",k),g.MV(f,12),g.S(f,fw9(G,W),14);case 14:g.tU(f,5);break;case 12:K=g.fH(f);Ui("Orchestration retry error",K);M=g.V(W);for(t=M.next();!t.done;t=M.next())R=t.value,R.retryScheduleIndex<3&&znd(G.V,[R]);f.sM(5);break;case 6:return g.S(f,gje(G),
0)}})},dSd=function(G,m,w){var W,U,c,Q,D,O,q,T,a,Z,k,K;
return g.h(function(M){switch(M.Y){case 1:W=m.retryScheduleIndex+2===3;if(w.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){M.sM(2);break}if(w.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){M.sM(0);break}NVe(m,w,W);if(w.V&&m.retryScheduleIndex+1<3)return g.S(M,fw9(G,[m]),0);c=((U=w)==null?0:U.Y)?w.Y:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";Q={entityKey:m.action.entityKey,failureReason:c};D=void 0;g.Mu(G.h4)?D="mainVideoDownloadStateEntity":g.SX(G.h4)&&(D="musicTrackDownloadMetadataEntity");
if(!D||!w.downloadState){M.sM(7);break}O=g.Hd(m.action.entityKey).entityId;return g.S(M,ak(O,D,G.Y,w.downloadState),7);case 7:cS(G.L,Q);if(w.downloadState==="DOWNLOAD_STATE_FAILED"&&G.h4.J("html5_auto_retry_failed_pde_actions")){M.sM(0);break}Ui("Orchestration result is not retryable, deleting action");return g.S(M,$ac(G.Y,Ik(m).key),0);case 2:q=void 0;try{q=(T=w.D)==null?void 0:T.map(function(t){return G.createAction(t,m)})}catch(t){return NVe(m,w,W),a={entityKey:m.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},cS(G.L,a),Ui("Orchestration subactions creation error",t),M.return()}NVe(m,w,W,q);if(!q){M.sM(12);break}Z=q.map(function(t){return Ik(t)});
k=0;case 13:if(!(k<q.length)||G.j){M.sM(15);break}return g.S(M,BD(G.Y,{mode:"readwrite",p5:!0},function(t){var R=[];R.push(W6d(t,Z.slice(k,k+10),"offlineOrchestrationActionWrapperEntity"));return g.KY.all(R)}),16);
case 16:k+=10;M.sM(13);break;case 15:if(G.j)return G.j=!1,M.return();case 12:return K=Ik(m),g.S(M,$ac(G.Y,K.key),17);case 17:KBH(m,4),g.VZ(M)}})},SNR=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k;
return g.h(function(K){w=[];W=Infinity;U=4E3;c=g.V(m);for(Q=c.next();!Q.done;Q=c.next())D=Q.value,O=Number(D.enqueueTimeSec),q=Rnz(O),T=D.retryScheduleIndex,a=T!=null&&T>0,q>0&&a?(W=Math.min(W,O),U=Math.min(q,U)):w.push(D);isFinite(W)&&(!G.X.isActive()||W<G.C)&&(G.C=W,G.X.start(U));G.K.Zc()||(Z=w.length,w=w.filter(function(M){var t;M=((t=M.actionProto)==null?void 0:t.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!pjg.includes(M)}),k=w.length<Z,!G.X.isActive()&&k&&G.X.start(1));
w.length>0&&jMH(G,w);return g.S(K,bGq(G),0)})},ojq=function(G){var m,w,W,U,c,Q,D;
return g.h(function(O){if(O.Y==1)return g.S(O,Plm(G),2);m=O.V;w=[];W=g.V(m);for(U=W.next();!U.done;U=W.next())c=U.value,Q=g.Hd(c.key),D=Q.entityId,MAH(G.V,D)||w.push(c);return g.S(O,SNR(G,w),0)})},Rnz=function(G){G=G*1E3-Date.now();
return G>4E3?4E3:G},fw9=function(G,m){var w,W,U;
return g.h(function(c){w=g.V(m);for(W=w.next();!W.done;W=w.next()){U=W.value;var Q=void 0,D=void 0,O=((D=U.action)==null?void 0:(Q=D.actionMetadata)==null?void 0:Q.retryScheduleIntervalsInSeconds)||[1,2,4];Q=1;U.retryScheduleIndex<O.length&&(Q=O[U.retryScheduleIndex]);U.V=Q*1E3+Date.now();U.retryScheduleIndex++}return g.S(c,hnb(G,m),0)})},LBb=function(G){var m;
return g.h(function(w){if(w.Y==1)return g.S(w,yB(G.Y,"offlineOrchestrationActionWrapperEntity"),2);m=w.V;return g.S(w,SNR(G,m),0)})},jMH=function(G,m){m.length!==0&&m.forEach(function(w){w=Nd(w);
w.retryScheduleIndex<3&&znd(G.V,[w])})},Plm=function(G,m){var w;
return g.h(function(W){if(W.Y==1)return g.S(W,yB(G.Y,"offlineOrchestrationActionWrapperEntity",m),2);w=W.V;return W.return(w.filter(Iaf))})},hnb=function(G,m){if(m.length===0)return Promise.resolve([]);
m=m.map(function(w){return Ik(w)});
return T2c(G.Y,m)},lwg=function(G){this.oy=G;
this.V=void 0},Cle=function(G,m){var w,W,U,c;
return g.h(function(Q){w=m.videoId;W=!0;if(m.captionTracks.length)U=BP4(m),G.V=new g.d6(G.oy,m,U);else if(m.jZ)c=g.Aid(m),G.V=new g.Rl(G.oy,m.jZ,w,c,m.KT,m.eventId),W=m.KT;else return Q.return();return Q.return(new Promise(function(D){var O;(O=G.V)==null||O.Ng({A0:function(){return g.h(function(q){if(q.Y==1)return g.S(q,G.A0(w,W),2);D();g.VZ(q)})},
qb:function(){}})}))})},Ejg=function(G){var m;
return g.h(function(w){if(w.Y==1)return g.S(w,ba4(G),2);m=w.V;return w.return(!!m&&m.length>0)})},Jg=function(G){g.J.call(this);
this.V=G;this.Y=this.V.observe(this.X.bind(this))},Jpb=function(G,m){var w,W,U,c,Q,D,O;
return g.h(function(q){switch(q.Y){case 1:if(m.length===0)return q.return([]);w=m.map(function(T){return g.Yi(T,"transfer")});
return g.S(q,yB(G.V,"transfer",w),2);case 2:W=q.V;U=W.filter(Iaf).map(function(T){return g.Hd(T.key).entityId});
c=m.filter(function(T){return U.indexOf(T)===-1});
if(c.length===0)return q.return([]);Q=g.V(c);D=Q.next();case 3:if(D.done){q.sM(5);break}O=D.value;return g.S(q,USH(O),4);case 4:D=Q.next();q.sM(3);break;case 5:return q.return(c)}})},enz=function(G,m,w,W,U,c){var Q,D,O;
return g.h(function(q){Q="STREAM_TYPE_UNKNOWN";w.video&&w.audio?(Q="STREAM_TYPE_AUDIO_AND_VIDEO",Ui("unexpected stream type")):w.video&&!w.audio?Q="STREAM_TYPE_VIDEO":!w.video&&w.audio&&(Q="STREAM_TYPE_AUDIO");D=g.Yi(m,"offlineVideoStreams");O={numBytesDownloaded:U.toFixed(),numTotalBytes:c.toFixed(),streamType:Q,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(W),itag:Q==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(w.itag):void 0};return g.S(q,BD(G,{mode:"readwrite",p5:!0},
function(T){var a=Fi(T,D,"offlineVideoStreams"),Z=Fi(T,g.Yi(m,"transfer"),"transfer");return g.KY.all([a,Z]).then(function(k){k=g.V(k);var K=k.next().value;k=k.next().value;if(!k)return ur(T,D).then(function(){});
var M=rpd(K);K=FBb(K,W,O,D);var t=xd(T,K,"offlineVideoStreams");rpd(K)>M&&(k.lastProgressTimeMs=Date.now().toString());M=[t];k.offlineVideoStreams||(k.offlineVideoStreams=[]);k.offlineVideoStreams.indexOf(D)===-1&&(k.offlineVideoStreams.push(D),M.push(xd(T,k,"transfer")));return g.KY.all(M)})}),0)})},nje=function(G,m){var w,W,U,c,Q;
return g.h(function(D){if(D.Y==1)return w=g.Yi(m,"offlineVideoStreams"),g.S(D,Xi(G,w,"offlineVideoStreams"),2);W=D.V;if(!W||!W.streamsProgress)return D.return();U=g.V(W.streamsProgress);for(c=U.next();!c.done;c=U.next())Q=c.value,Q.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",Q.numTotalBytes!==Q.numBytesDownloaded&&(Q.numBytesDownloaded=Q.numTotalBytes);return g.S(D,AR(G,W,"offlineVideoStreams"),0)})},FBb=function(G,m,w,W){if(G&&G.streamsProgress){W=G;
a:{m=m.itag+";"+m.xtags;for(var U=G.streamsProgress,c=0;c<U.length;c++){var Q=JSON.parse(U[c].formatStreamBytes);if(Q.itag+";"+Q.xtags===m){U[c]=w;w=U;break a}}U.push(w);w=U}W.streamsProgress=w}else G={key:W,streamsProgress:[w]};return G},rpd=function(G){if(G==null?0:G.streamsProgress){var m=0;
G=G.streamsProgress;for(var w=0;w<G.length;w++){var W=G[w];isNaN(Number(W.numBytesDownloaded))?Ui("stream progress bytes number invalid"):m+=Number(W.numBytesDownloaded)}return m}return 0},xSb=function(G,m,w,W){g.J.call(this);
var U=this;this.Y=G;this.api=m;this.Z6=w;this.D6=W;this.K=new g.rA;this.D=new g.ey(function(){U.V&&U.V.transferState==="TRANSFER_STATE_TRANSFERRING"&&U.K.Zc()&&((U.V.transferRetryCount||0)<3?C7(U.L,U.j,!1,!1):lY(U.L,U.j.videoDetails.videoId),U.gj("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.YB=this.rd=0;this.U=this.C=!1;this.OM=g.mN(this.api.S().experiments,"html5_transfer_processing_logs_interval");this.EM=new g.Mh(this);this.VU={Oz4:function(){return U.D},
j$6:function(){return U.D6},
aD:function(){return U.K}};
this.M9=this.Y.observe(this.hZ.bind(this));this.L=new WB9(m,this);this.kB=new lwg(m);this.J4=new Jg(this.Y);this.Pk=this.K.listen("publicytnetworkstatus-online",this.V3.bind(this));this.pM=this.K.listen("publicytnetworkstatus-offline",this.Wsp.bind(this));this.U=this.api.S().J("html5_less_transfer_processing_logs");g.r(this,this.EM);this.EM.T(m,"offlinetransferpause",this.SQE);if(g.Mu(this.api.S()))this.X="mainVideoDownloadStateEntity";else if(g.SX(this.api.S())||g.bH(this.api.S()))this.X="musicTrackDownloadMetadataEntity"},
uqd=function(G){return g.h(function(m){if(m.Y==1)m=g.S(m,M_q(),2);
else{var w=G.J4;var W=g.W9();W=Object.keys(W);w=Jpb(w,W);m=g.S(m,w,0)}return m})},FF=function(G,m){m=m===void 0?!1:m;
var w;return g.h(function(W){if(W.Y==1){if(G.V)throw Error("Already downloading a video");G.YB=0;G.C=!1;return g.S(W,HGd(G),2)}return W.Y!=4?(w=W.V,Ylq(G.Z6,!w),w&&G.K.Zc()?m?g.S(W,new Promise(function(U){g.Dn(U,1E3)}),4):W.sM(4):(!w&&G.V&&rE(G),W.sM(0))):g.S(W,YNg(G,w),0)})},BVb=function(G){return g.h(function(m){if(m.Y==1)return G.j?g.S(m,lY(G.L,G.j.videoDetails.videoId),3):m.sM(0);
rE(G);g.VZ(m)})},Ap9=function(G,m){var w,W,U;
return g.h(function(c){switch(c.Y){case 1:return g.MV(c,2),(w=!!m.captionTracks.length||!!m.jZ)?g.S(c,Ejg(m.videoId),4):c.return();case 4:return(W=c.V)?c.return():g.S(c,Cle(G.kB,m),5);case 5:g.tU(c,0);break;case 2:U=g.fH(c),Ui("Caption downloading error",U,m.cotn),g.VZ(c)}})},YNg=function(G,m){var w,W,U,c,Q,D;
return g.h(function(O){switch(O.Y){case 1:if(G.C)return O.return();G.C=!0;G.V=m;w=g.Hd(G.V.key);W=w.entityId;U=void 0;if(G.V.transferState==="TRANSFER_STATE_TRANSFERRING")return g.S(O,et(G,W),7);if(G.V.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||G.V.transferRetryCount||G.V.hasLoggedFirstStarted){O.sM(3);break}return g.S(O,et(G,W),5);case 5:return U=O.V,G.V.hasLoggedFirstStarted=!0,g.S(O,XjR(G),6);case 6:A39({videoId:W,xw:G.V,offlineModeType:U},void 0,void 0,!0);O.sM(3);break;case 7:U=O.V,
Dr({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:W,xw:G.V,offlineModeType:U});case 3:return g.S(O,ypm(G),8);case 8:return c=null,g.MV(O,9),g.S(O,GDm(G,m),11);case 11:c=O.V;G.j=c;g.tU(O,10);break;case 9:return Q=g.fH(O),Ui("error getting player response",Q,m.cotn),g.S(O,G.gj("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return O.return();case 10:return D=Uqz(G.api.S(),m.cotn,c),g.S(O,Ap9(G,D),13);case 13:return g.S(O,sMf(D.videoId),
14);case 14:D.wD=O.V,DSn(G.L,D,m.maximumDownloadQuality),G.D.start(108E5),g.VZ(O)}})},HGd=function(G){var m,w;
return g.h(function(W){if(W.Y==1)return g.S(W,yB(G.Y,"transfer"),2);m=W.V;w=m.filter(mHe).sort(wlH);return w.length===0?W.return():W.return(w[0])})},ypm=function(G){var m,w,W;
return g.h(function(U){if(U.Y==1){if(!G.V)return n7(G,"onTransferStart"),U.return();G.D.start(108E5);return g.S(U,xv(G,"TRANSFER_STATE_TRANSFERRING"),2)}m=G.V;return(W=((w=m)==null?0:w.key)?g.Hd(m.key).entityId:"")&&G.X?g.S(U,ak(W,G.X,G.Y,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):U.sM(0)})},QMb=function(G){var m,w,W,U;
g.h(function(c){switch(c.Y){case 1:if(!G.V){n7(G,"onTransferPausedByUser");c.sM(2);break}m=G.V;G.D.stop();return g.S(c,xv(G,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:W=((w=m)==null?0:w.key)?g.Hd(m.key).entityId:"";if(!W||!G.X){c.sM(4);break}return g.S(c,ak(W,G.X,G.Y,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.S(c,et(G,W),6);case 6:U=c.V,y3c({videoId:W,xw:m,offlineModeType:U});case 2:rE(G),FF(G),g.VZ(c)}})},vjq=function(G){var m,w,W;
g.h(function(U){if(U.Y==1){if(!G.V)return n7(G,"onTransferPausedByNetwork"),U.return();G.D.stop();return g.S(U,xv(G,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(U.Y!=3)return m=G.V,(W=((w=m)==null?0:w.key)?g.Hd(m.key).entityId:"")&&G.X?g.S(U,ak(W,G.X,G.Y,"DOWNLOAD_STATE_PAUSED"),3):U.sM(3);rE(G);g.VZ(U)})},WGz=function(G){var m,w,W,U,c;
g.h(function(Q){switch(Q.Y){case 1:if(!G.V)return n7(G,"onTransferComplete"),Q.return();m=G.V;G.D.stop();if(!m||!G.j){Q.sM(2);break}w=Uqz(G.api.S(),m.cotn,G.j);return g.S(Q,Ap9(G,w),2);case 2:return g.S(Q,xv(G,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:U=((W=m)==null?0:W.key)?g.Hd(m.key).entityId:"";if(!U||!G.X){Q.sM(5);break}return g.S(Q,ak(U,G.X,G.Y,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.S(Q,nje(G.Y,U),7);case 7:return g.S(Q,et(G,U),8);case 8:c=Q.V,Dr({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:U,xw:m,offlineModeType:c}),rE(G),FF(G),g.VZ(Q)}})},UHH=function(G,m,w){var W,U;
g.h(function(c){switch(c.Y){case 1:if(!G.V)return n7(G,"onTransferProgress: "+m),c.return();if(G.V.transferState==="TRANSFER_STATE_TRANSFERRING"){c.sM(2);break}return g.S(c,ypm(G),2);case 2:W=Date.now();if(!(W-G.rd>1E3)){c.sM(4);break}G.rd=W;return g.S(c,enz(G.Y,w.videoId,w.Y,w.hj,w.bytesDownloaded,w.V),5);case 5:if(G.U&&!(G.U&&W-G.YB>G.OM)){c.sM(4);break}G.YB=W;return g.S(c,et(G,m),7);case 7:U=c.V,A39({videoId:m,xw:G.V,offlineModeType:U},w.bytesDownloaded,w.V);case 4:G.D.start(108E5),g.VZ(c)}})},
swn=function(G){var m=(G.V.transferRetryCount||0)<3;
m&&(G=G.V,G.transferRetryCount=(G.transferRetryCount||0)+1);return m},c9H=function(G,m){m=m===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":m;
var w,W,U,c;return g.h(function(Q){if(Q.Y==1)return G.V||n7(G,"setTransferToFailed: "+m),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m==="TRANSFER_FAILURE_REASON_NETWORK"?w="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":m==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.S(Q,xv(G,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",m),2);if(Q.Y!=3)return cS(G.D6,{entityKey:(W=G.V)==null?void 0:W.key,failureReason:w}),
U=G.V?g.Hd(G.V.key).entityId:"",g.S(Q,et(G,U),3);c=Q.V;var D={videoId:U,xw:G.V,offlineModeType:c},O=m,q={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};O&&(q.transferFailureReason=O,q.failureReason=G6f(O));Dr(q,D);g.VZ(Q)})},xv=function(G,m,w,W){var U;
return g.h(function(c){if(c.Y==1){if(!G.V)return n7(G,"saveTransferState: "+m),c.return();G.V.transferState=m;G.V.failureReason=W;g.MV(c,2);return g.S(c,XjR(G,function(Q){return w?en(Q,"offlineVideoStreams",G.V.offlineVideoStreams).then(function(D){for(var O=g.V(D),q=O.next();!q.done;q=O.next())if((q=q.value)&&q.streamsProgress){q=g.V(q.streamsProgress);for(var T=q.next();!T.done;T=q.next())T.value.streamState=w}return W6d(Q,D.filter(function(a){return!!a}),"offlineVideoStreams")}):g.KY.resolve(void 0)}),
4)}if(c.Y!=2)return g.tU(c,0);
U=g.fH(c);return U instanceof g.qD&&U.type==="QUOTA_EXCEEDED"?g.S(c,G.gj("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):c.sM(0)})},XjR=function(G,m){var w;
return g.h(function(W){if(!G.V)return W.return();w=G.V;return g.S(W,BD(G.Y,{mode:"readwrite",p5:!0},function(U){var c=[xd(U,w,"transfer")];m&&c.push(m(U));return g.KY.all(c)}),0)})},rE=function(G){G.V=void 0;
G.j=void 0;G.D.stop()},GDm=function(G,m){var w,W,U,c,Q;
return g.h(function(D){if(D.Y==1)return w=g.Hd(m.key),W=w.entityId,U=g.Yi(W,"playbackData"),g.S(D,Xi(G.Y,U,"playbackData"),2);c=D.V;if((Q=c)==null?0:Q.playerResponseJson)return D.return(JSON.parse(c.playerResponseJson));throw Error("No PlayerResponse found");})},n7=function(G,m){G.api.XC("woffle",{mcte:m});
Ui("missing current transfer entity.")},et=function(G,m){var w,W,U;
return g.h(function(c){if(c.Y==1)return g.S(c,Xi(G.Y,g.Yi(m,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);w=c.V;return c.return((U=(W=w)==null?void 0:W.offlineModeType)!=null?U:void 0)})},mHe=function(G){return Qwn[G.transferState]!==void 0},wlH=function(G,m){var w=Qwn[G.transferState],W=Qwn[m.transferState];
return w!==W?w-W:Number(G.enqueuedTimestampMs)-Number(m.enqueuedTimestampMs)},uY=function(G,m){var w=this;
this.h4=G;this.api=m;this.K=new g.rA;this.j=new g.Da;this.VU={Xe:function(){return w.X.VU.Xe()},
aD:function(){return w.K},
Jtj:function(){return w.X},
f$:function(){return w.f$()},
Uu:function(){return w.Uu()},
Vh:function(){return w.Vh()},
Dt:function(){return w.Dt()},
hs:function(){return w.hs()},
XX:function(W){return w.XX(W)}};
this.X=new n9q(function(){return v4R(w)},function(){w.Vh()},this.api.o3(),this.api.J.bind(this.api));
this.V=new si(this.api);xaz(this.X)},v4R=function(G){return g.h(function(m){G.api.G2("onOrchestrationBecameLeader");
return g.S(m,G.Uu(),0)})},OXf=function(G){var m,w;
return g.h(function(W){if(W.Y==1)return g.S(W,GY(),2);if(W.Y!=3){m=W.V;if(!m)return Ui("PES is undefined"),W.return();G.Y=new xSb(m,G.api,G.X,G.V);w=G.mz(m);return g.S(W,tAq(m,w,G.X,G.V,G.h4),3)}G.L=W.V;return g.S(W,DHd(G),0)})},DHd=function(G){var m;
return g.h(function(w){switch(w.Y){case 1:if(!G.Y)return Ui("transferManager is undefined"),w.return();if(G.Y.V){w.sM(2);break}return g.S(w,FF(G.Y),2);case 2:if(!G.h4.J("woffle_enable_main_downloads_library")){w.sM(4);break}return g.S(w,G.Yy(),4);case 4:if(!G.h4.J("html5_offline_playback_position_sync")){w.sM(6);break}return g.S(w,G.R9(),7);case 7:return g.S(w,G.XX(864E5),6);case 6:return g.S(w,G.refreshAllStaleEntities(43200,!0),9);case 9:return g.S(w,G.XB(),10);case 10:if(!G.h4.J("html5_retry_downloads_for_expiration")){w.sM(11);
break}return g.S(w,G.hs(),11);case 11:return G.C=g.Oh(function(){G.refreshAllStaleEntities(43200,!0);G.XB()},9E5),g.xN(g.H1(),function(){return G.Dt()}),g.S(w,GY(),13);
case 13:return m=w.V,g.S(w,ePn(m),14);case 14:uxq(G.X),g.VZ(w)}})},qnz=function(){var G,m,w,W,U,c;
return g.h(function(Q){switch(Q.Y){case 1:return g.S(Q,GY(),2);case 2:G=Q.V;if(!G)return Q.return([]);m=Date.now()/1E3;return g.S(Q,yB(G,"offlineVideoPolicy"),3);case 3:w=Q.V,W=g.V(w),U=W.next();case 4:if(U.done){Q.sM(6);break}c=U.value;if(!(c.expirationTimestamp&&Number(c.expirationTimestamp)<m)){Q.sM(5);break}c.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";c.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.S(Q,AR(G,c,"offlineVideoPolicy"),5);
case 5:U=W.next();Q.sM(4);break;case 6:return Q.return(w.map(function(D){return D.key}))}})},HS=function(G,m,w,W,U){var c,Q,D;
return g.h(function(O){if(O.Y==1)return g.S(O,GY(),2);c=O.V;if(!c)return O.return([]);Q=m.map(function(q){var T=g.Yi(q,w);T={actionType:W,entityKey:T,actionMetadata:Object.assign({},sic(),U)};W!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(T.actionMetadata.priority=0);q=new K7(w,q,T);return Ik(q)});
D=T2c(c,Q);xaz(G.X);return O.return(D)})},TDe=function(G,m,w,W){var U,c,Q,D,O,q,T,a;
return g.h(function(Z){switch(Z.Y){case 1:U=[],c=g.V(m),Q=c.next();case 2:if(Q.done){Z.sM(4);break}D=Q.value;if(D.upToDate||w&&!D.shouldAutoSyncMetadata||!D.playlistId){Z.sM(3);break}O={};switch(W){case "mainPlaylistEntity":q={nextAutoRefreshIntervalSeconds:D.checkInSeconds,autoSync:w};O={mainPlaylistEntityActionMetadata:q};break;case "musicPlaylist":T={autoSync:w},O={musicPlaylistEntityActionMetadata:T}}return g.S(Z,HS(G,[D.playlistId],W,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O),6);case 6:(a=
Z.V)&&U.push.apply(U,g.Z$(a));case 3:Q=c.next();Z.sM(2);break;case 4:return Z.return(U)}})},$Hd=function(G,m){var w;
return g.h(function(W){return m.length?(w=sic(),g.P7(w,ok,{isEnqueuedForExpiredStreamUrlRefetch:!0}),G.api.XC("qrd",{v:m.length}),W.return(HS(G,m,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w))):W.return([])})},aEq=function(G,m,w){this.V=G;
this.h4=m;this.X=w},iX4=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f;
return g.h(function(P){switch(P.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey),U=W.entityId,c=[],g.MV(P,2),g.S(P,ZXH(G,U),4);case 4:c=P.V;if(!(G.h4.J("woffle_enable_main_downloads_library")&&((Q=c)==null?0:Q.length))){P.sM(5);break}return g.S(P,K3b(G.V,[m.entityKey]),5);case 5:g.tU(P,3);break;case 2:return D=g.fH(P),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.qD&&D.type==="QUOTA_EXCEEDED"?(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Ui("Playlist add error"),P.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,O,q));case 3:T=[];if(!G.h4.J("html5_offline_prevent_redownload_downloaded_video")){P.sM(7);break}return g.S(P,W3g(G.V,"mainVideoEntity",c),8);case 8:c=P.V;case 7:if((a=c)==null?0:a.length)for(Z=g.V(c),k=Z.next();!k.done;k=Z.next())if(K=k.value,M=K.offlineVideoData,t=void 0,(t=M)==null?0:t.videoId)R=void 0,f=Number(((R=m.actionMetadata)==null?void 0:R.priority)||
0)+1,T.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"mainVideoEntity",f,Yv,kDn(m,M,U)));return P.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,T))}})},ND4=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF,lR,nd,vY,p,FK,Sb,WW,bR,L,wd,gQ,vk,rc,uq,wc,wO,eU,b,z,d,l,F,$6,u,y,C,PW,F6,cW,Oq,jV,bq,mm,Ld,Cd,gd,V7,R9,Pg,tz;
return g.h(function(Dy){switch(Dy.Y){case 1:return w=Oi(m),W=m.entityKey,U=g.Hd(W).entityId,c=[],Q=!1,U==="!*$_ALL_ENTITIES_!*$"?(Q=!0,g.S(Dy,yB(G.V,"mainPlaylistEntity"),5)):g.S(Dy,Xi(G.V,W,"mainPlaylistEntity"),4);case 4:(D=Dy.V)&&c.push(D);Dy.sM(3);break;case 5:c=Dy.V;case 3:if((O=c)==null||!O.length)return Dy.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));q=g.n(m.actionMetadata,KGd);a=(T=q)==null?void 0:T.nextAutoRefreshIntervalSeconds;k=(Z=q)==null?void 0:Z.autoSync;K=[];t=M=
!0;R=!1;if(!Q&&k===!1){Dy.sM(6);break}g.MV(Dy,7);return g.S(Dy,jib(0,!!k,!0,c),9);case 9:K=Dy.V;g.tU(Dy,8);break;case 7:f=g.fH(Dy);if(!(f instanceof Error&&f.message==="No data")){f instanceof Error&&f.message==="Empty response body"&&Ui(f.message);Dy.sM(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.S(Dy,Thz(G.V,m,G.X,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.S(Dy,OTm(U,G.V,m,G.X),8);case 8:if(!K.length||!Q&&K[0].playlistId!==U)return Dy.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w));case 6:if(Q){P=[];E=g.V(K);for(e=E.next();!e.done;e=E.next())A=e.value,A.upToDate||k&&!A.shouldAutoSyncMetadata||!A.playlistId||(Y={nextAutoRefreshIntervalSeconds:A.checkInSeconds,autoSync:k},P.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A.playlistId,"mainPlaylistEntity",0,Yv,{mainPlaylistEntityActionMetadata:Y})));return Dy.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,P))}K.length&&(vW=K[0],R=!!vW.upToDate,k&&(M=(Oo=vW.shouldAutoSyncMetadata)!=null?Oo:!0,t=(QZ=vW.shouldAutoSyncVideos)!=
null?QZ:!0,vW.checkInSeconds&&(a=vW.checkInSeconds)));if(R||!M)return Dy.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));D$=[];me=c[0];if(!me.downloadState){dd=void 0;Dy.sM(15);break}return g.S(Dy,Xi(G.V,me.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:dd=Dy.V;case 15:return Y6=dd,iR=((Gm=Y6)==null?0:Gm.addedTimestampMillis)?String(Y6.addedTimestampMillis):void 0,g.MV(Dy,17),g.S(Dy,ZXH(G,U,iR,a),19);case 19:D$=Dy.V;g.tU(Dy,18);break;case 17:vg=g.fH(Dy);if(!(vg instanceof
Error&&vg.message==="No data for playlist")){if(vg instanceof Error&&vg.message==="Empty response body for playlist")Ui(vg.message);else return pH="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",QF="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",vg instanceof g.qD&&vg.type==="QUOTA_EXCEEDED"&&(pH="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",QF="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Dy.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,pH,QF));
Dy.sM(18);break}return g.S(Dy,OTm(U,G.V,m,G.X),18);case 18:if(!t)return Dy.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));lR=[];nd=new Map;if((vY=D$)==null?0:vY.length)for(p=g.V(D$),FK=p.next();!FK.done;FK=p.next())Sb=FK.value,WW=Sb.offlineVideoData,bR=void 0,((bR=WW)==null?0:bR.videoId)&&nd.set(WW.videoId,WW);L=new Map;wd=[];if((gQ=me)==null?0:(vk=gQ.videos)==null?0:vk.length)for(rc=g.V(me.videos),uq=rc.next();!uq.done;uq=rc.next())if(wc=uq.value,wO=JSON.parse(g.Hd(wc).entityId),
eU=wO.videoId)nd.has(eU)?(L.set(eU,nd.get(eU)),nd.delete(eU)):wd.push(eU);z=Number(((b=m.actionMetadata)==null?void 0:b.priority)||0)+1;d=g.V(nd.entries());for(l=d.next();!l.done;l=d.next())F=l.value,$6=g.V(F),u=$6.next().value,y=$6.next().value,C=u,PW=y,lR.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C,"mainVideoEntity",z,Yv,kDn(m,PW,U)));F6=g.V(L.entries());for(cW=F6.next();!cW.done;cW=F6.next())Oq=cW.value,jV=g.V(Oq),bq=jV.next().value,mm=jV.next().value,Ld=bq,Cd=mm,lR.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Ld,"mainVideoEntity",z,Yv,kDn(m,Cd,U)));gd=g.V(wd);for(V7=gd.next();!V7.done;V7=gd.next())R9=V7.value,Pg={playlistId:U},tz={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Pg},lR.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",R9,"mainVideoEntity",0,Yv,tz));return Dy.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,lR))}})},IEH=function(G,m){var w,W,U,c;
return g.h(function(Q){switch(Q.Y){case 1:return w=Oi(m),g.MV(Q,2),W=g.Hd(m.entityKey).entityId,W==="!*$_ALL_ENTITIES_!*$"?g.S(Q,Thz(G.V,m,G.X,(U=m.actionMetadata)==null?void 0:(c=U.offlineLoggingData)==null?void 0:c.offlineDeleteReason),5):g.S(Q,OTm(W,G.V,m,G.X),6);case 6:if(!G.h4.J("woffle_enable_main_downloads_library")){Q.sM(5);break}return g.S(Q,Nhe(G.V,m.entityKey),5);case 5:g.tU(Q,3);break;case 2:return g.fH(Q),Q.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},ZXH=function(G,m,w,W){var U,c,Q,D,O,q,T;
return g.h(function(a){switch(a.Y){case 1:return g.S(a,Ro4([m]),2);case 2:return U=a.V,g.S(a,z$4(G,U[0],w,W),3);case 3:return c=a.V,Q=c.mainPlaylistEntity,D=c.tZE,q=vEH(Q,(O=D)==null?void 0:O.avatar),g.MV(a,4),g.S(a,Vk(q),6);case 6:g.tU(a,5);break;case 4:T=g.fH(a),T instanceof Error&&T.message==="Failed to fetch"&&Ui(T.message);case 5:return a.return(U[0].videos)}})},z$4=function(G,m,w,W){var U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E;
return g.h(function(e){switch(e.Y){case 1:U=Date.now().toString();w||(w=U);c=m.videos;Q=m.playlistId;D=[];O=[];if(c)for(q=g.V(c),T=q.next();!T.done;T=q.next()){a=T.value;Z=a.offlineVideoData;if(!Z||!Z.videoId)throw Ui("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");k=Z.videoId;K={videoId:k,playlistId:Q};M={id:g.Yi(JSON.stringify(K),"mainPlaylistVideoEntity"),video:g.Yi(k,"mainVideoEntity")};D.push(M);O.push(M.id)}R={key:g.Yi(Q,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:w,lastSyncedTimestampMillis:U};f={key:g.Yi(Q,"mainPlaylistEntity"),playlistId:Q,videos:O,title:m.title,thumbnailStyleData:Vxm(m),visibility:Mx4(m),downloadState:R.key};m.channel&&(P=m.channel.offlineChannelData,t=LGe(g.Yi(Q,"ytMainChannelEntity"),P),f.channelOwner=t.id);((E=f)==null?0:E.entityMetadata)?(f.entityMetadata.offlineLastModifiedTimestampSeconds=m.lastModifiedTimestamp,W&&(f.entityMetadata.nextAutoRefreshIntervalSeconds=String(W))):f&&(f.entityMetadata={nextAutoRefreshIntervalSeconds:W?
String(W):void 0,offlineLastModifiedTimestampSeconds:m.lastModifiedTimestamp});g.MV(e,2);return g.S(e,BD(G.V,{mode:"readwrite",p5:!0},function(A){var Y=xd(A,f,"mainPlaylistEntity"),vW=xd(A,R,"mainPlaylistDownloadStateEntity");Y=[Y,vW];vW=g.V(D);for(var Oo=vW.next();!Oo.done;Oo=vW.next())Y.push(xd(A,Oo.value,"mainPlaylistVideoEntity"));t&&Y.push(xd(A,t,"ytMainChannelEntity"));return g.KY.all(Y)}),4);
case 4:g.tU(e,3);break;case 2:throw g.fH(e),Ui("PES failure for playlist"),Error("PES failure for playlist");case 3:return e.return({mainPlaylistEntity:f,tZE:t,FVf:D})}})},LGe=function(G,m){return{id:G,
channelId:m.channelId,title:m.title,avatar:m.thumbnail}},Vxm=function(G){var m=[],w=G.videos;
w&&w.length>0&&m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:w[0].offlineVideoData.thumbnail}}});if((G=G.additionalMetadadatas)&&G.length>0)for(G=g.V(G),w=G.next();!w.done;w=G.next()){var W=w.value.offlineBundleItemPlaylistData,U=void 0;w=(U=W)==null?void 0:U.style;U=void 0;W={collageThumbnail:{coverThumbnail:(U=W)==null?void 0:U.coverThumbnail}};switch(w){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:W});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:W});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:W});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":m.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:W})}}return m},Mx4=function(G){switch(G.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},kDn=function(G,m,w){m={offlineVideoData:m,
playlistId:w};if(G=g.n(G.actionMetadata,KGd))m.maximumDownloadQuality=G.maximumDownloadQuality;return{mainVideoEntityActionMetadata:m}},bXd=function(G,m,w){this.V=G;
this.h4=m;this.X=w},dH9=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K;
return g.h(function(M){switch(M.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey),U=W.entityId,c=g.n(m.actionMetadata,BS),D=!((Q=c)==null?0:Q.playlistId),g.MV(M,2),g.S(M,tx9(G,U,void 0,(O=c)==null?void 0:O.offlineVideoData,D),4);case 4:g.tU(M,3);break;case 2:return q=g.fH(M),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.qD&&q.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,T,a));case 3:Z=1;Z=Number(((k=m.actionMetadata)==null?void 0:k.priority)||0)+1;var t=(t=g.n(m.actionMetadata,BS))?{playbackDataActionMetadata:{maximumDownloadQuality:t.maximumDownloadQuality}}:void 0;K=St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",Z,g49,t);return M.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,[K]))}})},fE4=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f;
return g.h(function(P){switch(P.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey),U=W.entityId,g.S(P,Xi(G.V,m.entityKey,"mainVideoEntity"),2);case 2:c=P.V;if(!c){Q=void 0;P.sM(3);break}return g.S(P,Xi(G.V,c.downloadState,"mainVideoDownloadStateEntity"),4);case 4:Q=P.V;case 3:D=Q;if(!c||!D)return P.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.MV(P,5);return g.S(P,tx9(G,U,D.addedTimestampMillis,(q=g.n(m.actionMetadata,BS))==null?void 0:q.offlineVideoData),7);case 7:T=1;T=Number(((a=
m.actionMetadata)==null?void 0:a.priority)||0)+1;O=St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",T,g49);g.tU(P,6);break;case 5:Z=g.fH(P);if(!(Z instanceof Error&&Z.message==="No data")){if(Z instanceof Error&&Z.message==="Empty response body")Ui(Z.message);else return k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.qD&&Z.type==="QUOTA_EXCEEDED"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,k,K));P.sM(6);break}return g.S(P,bY(G.V,U),9);case 9:M=P.V;t=g.n(m.actionMetadata,BS);if(f=(R=t)==null?void 0:R.playlistId)M.playlistId=f;M.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.S(P,Md(U,G.V,m,G.X,M),6);case 6:return P.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,O?[O]:void 0))}})},R$q=function(G,m){var w,W,U,c,Q,D,O,q,T,a;
return g.h(function(Z){switch(Z.Y){case 1:return w=Oi(m),g.MV(Z,2),W=g.Hd(m.entityKey).entityId,W==="!*$_ALL_ENTITIES_!*$"?g.S(Z,Thz(G.V,m,G.X,(T=m.actionMetadata)==null?void 0:(a=T.offlineLoggingData)==null?void 0:a.offlineDeleteReason),5):g.S(Z,bY(G.V,W),6);case 6:U=Z.V;c=g.n(m.actionMetadata,BS);if(D=(Q=c)==null?void 0:Q.playlistId)U.playlistId=D;U.offlineDeleteReason=(O=m.actionMetadata)==null?void 0:(q=O.offlineLoggingData)==null?void 0:q.offlineDeleteReason;return g.S(Z,Md(W,G.V,m,G.X,U),7);
case 7:if(!G.h4.J("woffle_enable_main_downloads_library")){Z.sM(5);break}return g.S(Z,Nhe(G.V,m.entityKey),5);case 5:g.tU(Z,3);break;case 2:return g.fH(Z),Z.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},tx9=function(G,m,w,W,U){var c,Q,D,O,q,T;
return g.h(function(a){switch(a.Y){case 1:if(c=W){a.sM(2);break}return g.S(a,fKn([m]),3);case 3:Q=a.V,c=Q[0];case 2:return g.S(a,pln(G,c,w,U),4);case 4:D=a.V;O=D.mainVideoEntity;q=D.channelEntity;g.MV(a,5);var Z=iY(O.thumbnail),k=iY(q.avatar);return g.S(a,Vk(Z.concat(k)),7);case 7:g.tU(a,0);break;case 5:T=g.fH(a),T instanceof Error&&T.message==="Failed to fetch"&&Ui(T.message),g.VZ(a)}})},pln=function(G,m,w,W){var U,c,Q,D,O,q,T,a,Z,k,K,M,t;
return g.h(function(R){switch(R.Y){case 1:w||(w=Date.now().toString());c=(U=m.channel)==null?void 0:U.offlineChannelData;Q={id:g.Yi(m.videoId,"ytMainChannelEntity"),channelId:c.channelId,title:c.title,avatar:c.thumbnail};D={key:g.Yi(m.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Yi(m.videoId,"playbackData"),addedTimestampMillis:w,videoDownloadContextEntity:g.Yi(m.videoId,"videoDownloadContextEntity")};O={key:g.Yi(m.videoId,"videoPlaybackPositionEntity"),videoId:m.videoId,lastPlaybackPositionSeconds:"0"};
G.h4.J("html5_offline_playback_position_sync")&&(q={playbackPosition:O.key});T=g.Yi(m.videoId,"mainVideoEntity");a={key:T,videoId:m.videoId,title:m.title,thumbnail:m.thumbnail,localizedStrings:{viewCount:m.shortViewCountText},userState:q,lengthSeconds:m.lengthSeconds?Number(m.lengthSeconds):void 0,publishedTimestampMillis:m.publishedTimestamp?(Number(m.publishedTimestamp)*1E3).toString():void 0,formattedDescription:m.description,owner:Q.id,downloadState:D.key};if(!G.h4.J("woffle_enable_main_downloads_library")||
!W){R.sM(2);break}return g.S(R,iTR(G.V,[T]),3);case 3:if(K=R.V)Z=K.mainDownloadsLibraryEntity,k=K.mainDownloadsListEntity;case 2:return t=wvH,M={key:g.Yi(m.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.P7(D,t,M),g.S(R,BD(G.V,{mode:"readwrite",p5:!0},function(f){var P=xd(f,Q,"ytMainChannelEntity"),E=xd(f,D,"mainVideoDownloadStateEntity"),e=xd(f,a,"mainVideoEntity");P=[P,E,e];G.h4.J("html5_offline_playback_position_sync")&&(E=xd(f,O,"videoPlaybackPositionEntity"),
P.push(E));Z&&(E=xd(f,Z,"mainDownloadsLibraryEntity"),P.push(E));k&&(E=xd(f,k,"mainDownloadsListEntity"),P.push(E));M&&(f=xd(f,M,"downloadStatusEntity"),P.push(f));return g.KY.all(P)}),4);
case 4:return R.return({mainVideoEntity:a,channelEntity:Q})}})},jw9=function(G,m,w){this.V=G;
this.h4=m;this.X=w},P64=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me;
return g.h(function(dd){switch(dd.Y){case 1:return w=Oi(m),W=[],g.S(dd,EM.getInstance(),2);case 2:U=dd.V;if(!U){dd.sM(3);break}return g.S(dd,U.get("sdois"),4);case 4:return c=dd.V,g.S(dd,(D=U)==null?void 0:D.get("lmqf"),5);case 5:Q=dd.V;case 3:g.MV(dd,6);if(c===void 0)throw Error("prefStorage or opt-in state is undefined");O=[];if(c){dd.sM(8);break}return g.S(dd,k6q(G.V),9);case 9:O=dd.V,O.reverse();case 8:if(!O.length){dd.sM(10);break}q=g.V(O);T=q.next();case 11:if(T.done){dd.sM(10);break}a=T.value;
if(!a){dd.sM(12);break}Z=g.Hd(a).entityId;return g.S(dd,bY(G.V,Z),14);case 14:return k=dd.V,k.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.S(dd,Md(Z,G.V,{entityKey:a,actionType:m.actionType},G.X,k),12);case 12:T=q.next();dd.sM(11);break;case 10:return g.S(dd,P3e(c,(K=Q)!=null?K:"SD"),16);case 16:return M=dd.V,g.S(dd,$qb(M),17);case 17:t=ZTb(M);if(!G.h4.J("woffle_enable_main_downloads_library")){dd.sM(18);break}if(c){dd.sM(19);break}return g.S(dd,Nhe(G.V,g.lf),19);case 19:return g.S(dd,
K3b(G.V,[g.lf]),18);case 18:if((R=t)==null?0:R.length)for(f=g.V(t),P=f.next();!P.done;P=f.next())if(e=E=P.value,A=e.actionType,Y=e.entityKey,vW=e.actionMetadata,A&&Y&&vW&&!g.n(vW,Sn9)){A==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(vW.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Oo=g.n(E.actionMetadata,BS))Oo.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",E.actionMetadata=Object.assign({},E.actionMetadata,{mainVideoEntityActionMetadata:Oo});W.push(E)}g.tU(dd,
7);break;case 6:return QZ=g.fH(dd),D$="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",me="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",QZ instanceof g.qD&&QZ.type==="QUOTA_EXCEEDED"&&(D$="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",me="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),dd.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,D$,me));case 7:return dd.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,W))}})},o44=function(){uY.apply(this,
arguments);
this.U="mainVideoEntity"},h$4=function(G,m,w){m=m===void 0?43200:m;
w=w===void 0?!0:w;var W=W===void 0?!1:W;var U,c,Q;return g.h(function(D){switch(D.Y){case 1:if(!G.K.Zc())return D.return([]);U=[];g.MV(D,2);return g.S(D,jib(m,w,W),4);case 4:U=D.V;g.tU(D,3);break;case 2:c=g.fH(D),c instanceof Error&&c.message==="No data"||c instanceof Error&&c.message==="Empty response body"&&Ui(c.message);case 3:return Q=TDe(G,U,w,"mainPlaylistEntity"),D.return(Q)}})},lEm=function(G,m,w,W){W=W===void 0?!1:W;
var U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f;return g.h(function(P){switch(P.Y){case 1:return U=[],g.S(P,Skd(),2);case 2:return(c=P.V)||W?g.S(P,oEz(m,w),3):P.return([]);case 3:Q=P.V;if((D=Q)==null||!D.length)return P.return([]);O={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};q=g.V(Q);T=q.next();case 4:if(T.done){P.sM(6);break}Z=a=T.value;k=Z.actionType;K=Z.entityKey;M=Z.actionMetadata;if(!(k&&K&&M)||g.n(M,Sn9)){P.sM(5);break}k==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(M.offlineLoggingData=
O);t=g.Hd(K);R=t.entityId;return g.S(P,HS(G,[R],"mainVideoEntity",k,M),8);case 8:f=P.V,U=U.concat(f);case 5:T=q.next();P.sM(4);break;case 6:return P.return(U)}})},C6b=function(G,m){this.V=G;
this.X=m},J9m=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R;
return g.h(function(f){switch(f.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey),U=W.entityId,c=[],g.MV(f,2),g.S(f,E4m(G,U),4);case 4:c=f.V;if((Q=c)==null||!Q.length){f.sM(5);break}return g.S(f,L3R(G.V,m.entityKey),5);case 5:g.tU(f,3);break;case 2:return D=g.fH(f),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.qD&&D.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
f.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,O,q));case 3:return T=[],g.S(f,W3g(G.V,"musicTrack",c),7);case 7:c=f.V;if(c.length)for(a=g.V(c),Z=a.next();!Z.done;Z=a.next())if(k=Z.value,K=k.offlineVideoData,M=void 0,(M=K)==null?0:M.videoId)t=void 0,R=Number(((t=m.actionMetadata)==null?void 0:t.priority)||0)+1,T.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K.videoId,"musicTrack",R,Ag,f7(m,K,U)));return f.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,T))}})},
r94=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF,lR,nd,vY,p,FK,Sb,WW,bR,L,wd,gQ,vk,rc,uq,wc,wO,eU,b,z,d,l,F,$6,u,y;
return g.h(function(C){switch(C.Y){case 1:return w=Oi(m),W=m.entityKey,U=g.Hd(W).entityId,c=[],Q=!1,U==="!*$_ALL_ENTITIES_!*$"?(Q=!0,g.S(C,yB(G.V,"musicAlbumRelease"),5)):g.S(C,Xi(G.V,W,"musicAlbumRelease"),4);case 4:(D=C.V)&&c.push(D);C.sM(3);break;case 5:c=C.V;case 3:if((O=c)==null||!O.length)return C.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));if(Q){q=[];T=g.V(c);for(a=T.next();!a.done;a=T.next())Z=a.value,k=g.Hd(Z.id).entityId,q.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
k,"musicAlbumRelease",0,Ag));return C.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,q))}K=[];M=c[0];t=void 0;if(!M.downloadMetadata){C.sM(6);break}return g.S(C,Xi(G.V,M.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:R=C.V,t=Number((P=(f=R)==null?void 0:f.addedTimestampMillis)!=null?P:"0")/1E3;case 6:return g.MV(C,8),g.S(C,E4m(G,U,(E=t)==null?void 0:E.toString()),10);case 10:K=C.V;g.tU(C,9);break;case 8:e=g.fH(C);if(!(e instanceof Error&&e.message==="No data")){if(e instanceof
Error&&e.message==="Empty response body")Ui(e.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.qD&&e.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,A,Y));C.sM(9);break}return g.S(C,gE(U,"musicAlbumRelease",G.V,m,G.X),9);case 9:vW=[];Oo=new Map;
if((QZ=K)==null?0:QZ.length)for(D$=g.V(K),me=D$.next();!me.done;me=D$.next())dd=me.value,Y6=dd.offlineVideoData,Gm=void 0,((Gm=Y6)==null?0:Gm.videoId)&&Oo.set(Y6.videoId,Y6);iR=new Map;vg=[];if((pH=M)==null?0:(QF=pH.tracks)==null?0:QF.length)for(lR=g.V(M.tracks),nd=lR.next();!nd.done;nd=lR.next())if(vY=nd.value,p=g.Hd(vY).entityId)Oo.has(p)?(iR.set(p,Oo.get(p)),Oo.delete(p)):vg.push(p);Sb=Number(((FK=m.actionMetadata)==null?void 0:FK.priority)||0)+1;WW=g.V(Oo.entries());for(bR=WW.next();!bR.done;bR=
WW.next())L=bR.value,wd=g.V(L),gQ=wd.next().value,vk=wd.next().value,rc=gQ,uq=vk,vW.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",rc,"musicTrack",Sb,Ag,f7(m,uq)));wc=g.V(iR.entries());for(wO=wc.next();!wO.done;wO=wc.next())eU=wO.value,b=g.V(eU),z=b.next().value,d=b.next().value,l=z,F=d,vW.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l,"musicTrack",Sb,Ag,f7(m,F)));$6=g.V(vg);for(u=$6.next();!u.done;u=$6.next())y=u.value,vW.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",y,"musicTrack",
0,Ag));return C.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,vW))}})},FGR=function(G,m){var w,W;
return g.h(function(U){switch(U.Y){case 1:return w=Oi(m),g.MV(U,2),W=g.Hd(m.entityKey).entityId,W==="!*$_ALL_ENTITIES_!*$"?g.S(U,dE(G.V,m,G.X),5):g.S(U,gE(W,"musicAlbumRelease",G.V,m,G.X),6);case 6:return g.S(U,bTq(G.V,m.entityKey),5);case 5:g.tU(U,3);break;case 2:return g.fH(U),U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},E4m=function(G,m,w){var W,U,c;
return g.h(function(Q){switch(Q.Y){case 1:return g.S(Q,Ro4([m]),2);case 2:return W=Q.V,g.S(Q,e$R(G,W[0],w),3);case 3:return U=Q.V,c=iY(U.thumbnailDetails),g.S(Q,Vk(c),4);case 4:return Q.return(W[0].videos)}})},e$R=function(G,m,w){var W,U,c,Q,D,O,q,T,a,Z,k,K,M,t;
return g.h(function(R){if(R.Y==1){W=m.additionalMetadadatas;U=void 0;if(W&&W.length>0)for(c=g.V(W),Q=c.next();!Q.done;Q=c.next())if(D=Q.value,D.offlineMusicPlaylistData){U=D.offlineMusicPlaylistData;break}O=m.playlistId;q=tyf(m);T=q.hq;a=q.bV;Z=w?(Number(w)*1E3).toString():Date.now().toString();k=m.lastModifiedTimestamp?(Number(m.lastModifiedTimestamp)*1E3).toString():"0";K={id:g.Yi(O,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:k,addedTimestampMillis:Z,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};M={id:g.Yi(O,"musicAlbumRelease"),title:m.title,audioPlaylistId:O,trackCount:m.totalVideoCount,tracks:T,downloadMetadata:K.id};U&&(M.thumbnailDetails=(t=U.albumHqThumbnail)!=null?t:U.albumArtistThumbnail,M.artistDisplayName=U.albumArtistDisplayName,M.releaseDate=U.albumReleaseDate,M.contentRating={explicitType:U.albumReleaseExplicitType},M.releaseType=U.albumReleaseType);return g.S(R,BD(G.V,{mode:"readwrite",p5:!0},function(f){var P=xd(f,M,"musicAlbumRelease");
f=xd(f,K,"musicAlbumReleaseDownloadMetadataEntity");return g.KY.all([P,f])}),2)}return R.return(M)})},n4d=function(G,m){this.V=G;
this.X=m},u7d=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R;
return g.h(function(f){switch(f.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey),U=W.entityId,c=[],g.MV(f,2),g.S(f,xHH(G,U),4);case 4:c=f.V;if((Q=c)==null||!Q.length){f.sM(5);break}return g.S(f,L3R(G.V,m.entityKey),5);case 5:g.tU(f,3);break;case 2:return D=g.fH(f),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.qD&&D.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
f.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,O,q));case 3:return T=[],g.S(f,W3g(G.V,"musicTrack",c),7);case 7:c=f.V;if(c.length)for(a=g.V(c),Z=a.next();!Z.done;Z=a.next())if(k=Z.value,K=k.offlineVideoData,M=void 0,(M=K)==null?0:M.videoId)t=void 0,R=Number(((t=m.actionMetadata)==null?void 0:t.priority)||0)+1,T.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K.videoId,"musicTrack",R,XF,f7(m,K,U)));return f.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,T))}})},
HXf=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF,lR,nd,vY,p,FK,Sb,WW,bR,L,wd,gQ,vk,rc,uq,wc,wO,eU,b,z,d,l,F,$6,u,y,C,PW,F6,cW,Oq,jV,bq,mm,Ld,Cd,gd,V7;
return g.h(function(R9){switch(R9.Y){case 1:return w=Oi(m),W=m.entityKey,U=g.Hd(W).entityId,c=[],Q=!1,U==="!*$_ALL_ENTITIES_!*$"?(Q=!0,g.S(R9,yB(G.V,"musicPlaylist"),5)):g.S(R9,Xi(G.V,W,"musicPlaylist"),4);case 4:(D=R9.V)&&c.push(D);R9.sM(3);break;case 5:c=R9.V;case 3:if((O=c)==null||!O.length)return R9.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));q=g.n(m.actionMetadata,gEq);a=(T=q)==null?void 0:T.autoSync;Z=[];K=k=!0;M=!1;t=void 0;if(!Q&&a===!1){R9.sM(6);break}g.MV(R9,7);return g.S(R9,
hom(0,!!a,!0,c),9);case 9:Z=R9.V;g.tU(R9,8);break;case 7:R=g.fH(R9);if(!(R instanceof Error&&R.message==="No data")){R instanceof Error&&R.message==="Empty response body"&&Ui(R.message);R9.sM(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.S(R9,dE(G.V,m,G.X),8):g.S(R9,gE(U,"musicPlaylist",G.V,m,G.X),8);case 8:if(!Z.length||!Q&&Z[0].playlistId!==U)return R9.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));case 6:if(Q){f=[];P=g.V(Z);for(E=P.next();!E.done;E=P.next())e=E.value,e.upToDate||
a&&!e.shouldAutoSyncMetadata||!e.playlistId||(A={autoSync:a},f.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e.playlistId,"musicPlaylist",0,XF,{musicPlaylistEntityActionMetadata:A})));return R9.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,f))}Z.length&&(Y=Z[0],M=!!Y.upToDate,a&&(k=(vW=Y.shouldAutoSyncMetadata)!=null?vW:!0,K=(Oo=Y.shouldAutoSyncVideos)!=null?Oo:!0,Y.checkInSeconds&&(t=Y.checkInSeconds)));if(M||!k)return R9.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w));QZ=[];D$=c[0];me=void 0;if(!D$.downloadMetadata){R9.sM(15);break}return g.S(R9,Xi(G.V,D$.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:dd=R9.V,me=Number((Gm=(Y6=dd)==null?void 0:Y6.addedTimestampMillis)!=null?Gm:"0")/1E3;case 15:return g.MV(R9,17),g.S(R9,xHH(G,U,(iR=me)==null?void 0:iR.toString(),t),19);case 19:QZ=R9.V;g.tU(R9,18);break;case 17:vg=g.fH(R9);if(!(vg instanceof Error&&vg.message==="No data")){if(vg instanceof Error&&vg.message==="Empty response body")Ui(vg.message);
else return pH="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",QF="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",vg instanceof g.qD&&vg.type==="QUOTA_EXCEEDED"&&(pH="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",QF="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R9.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,pH,QF));R9.sM(18);break}return g.S(R9,gE(U,"musicPlaylist",G.V,m,G.X),18);case 18:if(!K)return R9.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w));lR=[];nd=new Map;if((vY=QZ)==null?0:vY.length)for(p=g.V(QZ),FK=p.next();!FK.done;FK=p.next())Sb=FK.value,WW=Sb.offlineVideoData,bR=void 0,((bR=WW)==null?0:bR.videoId)&&nd.set(WW.videoId,WW);L=new Map;wd=[];if((gQ=D$)==null?0:(vk=gQ.tracks)==null?0:vk.length)for(rc=g.V(D$.tracks),uq=rc.next();!uq.done;uq=rc.next())if(wc=uq.value,wO=g.Hd(wc).entityId)nd.has(wO)?(L.set(wO,nd.get(wO)),nd.delete(wO)):wd.push(wO);b=Number(((eU=m.actionMetadata)==null?void 0:eU.priority)||0)+1;z=g.V(nd.entries());for(d=
z.next();!d.done;d=z.next())l=d.value,F=g.V(l),$6=F.next().value,u=F.next().value,y=$6,C=u,lR.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y,"musicTrack",b,XF,f7(m,C)));PW=g.V(L.entries());for(F6=PW.next();!F6.done;F6=PW.next())cW=F6.value,Oq=g.V(cW),jV=Oq.next().value,bq=Oq.next().value,mm=jV,Ld=bq,lR.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",mm,"musicTrack",b,XF,f7(m,Ld)));Cd=g.V(wd);for(gd=Cd.next();!gd.done;gd=Cd.next())V7=gd.value,lR.push(St("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
V7,"musicTrack",0,XF));return R9.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,lR))}})},YnH=function(G,m){var w,W;
return g.h(function(U){switch(U.Y){case 1:return w=Oi(m),g.MV(U,2),W=g.Hd(m.entityKey).entityId,W==="!*$_ALL_ENTITIES_!*$"?g.S(U,dE(G.V,m,G.X),5):g.S(U,gE(W,"musicPlaylist",G.V,m,G.X),6);case 6:return g.S(U,bTq(G.V,m.entityKey),5);case 5:g.tU(U,3);break;case 2:return g.fH(U),U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},xHH=function(G,m,w,W){var U,c,Q;
return g.h(function(D){switch(D.Y){case 1:return g.S(D,Ro4([m]),2);case 2:return U=D.V,g.S(D,BD9(G,U[0],w,W),3);case 3:return c=D.V,Q=iY(c.thumbnailDetails),g.S(D,Vk(Q),4);case 4:return D.return(U[0].videos)}})},BD9=function(G,m,w,W){var U,c,Q,D,O,q,T,a,Z;
return g.h(function(k){return k.Y==1?(U=m.playlistId,c=tyf(m),Q=c.hq,D=c.bV,O=w?(Number(w)*1E3).toString():Date.now().toString(),q=m.lastModifiedTimestamp?(Number(m.lastModifiedTimestamp)*1E3).toString():"0",T={id:g.Yi(U,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:q,addedTimestampMillis:O,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},a={id:g.Yi(U,"musicPlaylist"),title:m.title,playlistId:U,thumbnailDetails:m.thumbnail,visibility:A94(m),trackCount:m.totalVideoCount,
tracks:Q,downloadMetadata:T.id},W&&(((Z=a)==null?0:Z.entityMetadata)?a.entityMetadata.nextAutoRefreshIntervalSeconds=String(W):a&&(a.entityMetadata={nextAutoRefreshIntervalSeconds:String(W)})),g.S(k,BD(G.V,{mode:"readwrite",p5:!0},function(K){var M=xd(K,a,"musicPlaylist");K=xd(K,T,"musicPlaylistDownloadMetadataEntity");return g.KY.all([M,K])}),2)):k.return(a)})},A94=function(G){switch(G.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Xlq=function(G,m){this.V=G;
this.X=m},wAn=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K;
return g.h(function(M){switch(M.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey),U=W.entityId,c=g.n(m.actionMetadata,y9d),g.MV(M,2),g.S(M,Gsb(G,U,void 0,(Q=c)==null?void 0:Q.track,(D=c)==null?void 0:D.albumRelease),4);case 4:if((O=c)==null?0:O.playlistId){M.sM(5);break}return g.S(M,L3R(G.V,m.entityKey),5);case 5:g.tU(M,3);break;case 2:return q=g.fH(M),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.qD&&q.type==="QUOTA_EXCEEDED"&&
(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),M.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,T,a));case 3:k=Number(((Z=m.actionMetadata)==null?void 0:Z.priority)||0)+1;var t=(t=g.n(m.actionMetadata,y9d))?{playbackDataActionMetadata:{maximumDownloadQuality:t.maximumDownloadQuality}}:void 0;K=St("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",k,m4g,t);return M.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w,[K]))}})},WrH=function(G,m){var w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t;
return g.h(function(R){switch(R.Y){case 1:return w=Oi(m),W=g.Hd(m.entityKey),U=W.entityId,g.S(R,Xi(G.V,m.entityKey,"musicTrack"),2);case 2:c=R.V;if(!c){Q=void 0;R.sM(3);break}return g.S(R,Xi(G.V,c.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:Q=R.V;case 3:D=Q;if(!c||!D)return R.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));q=g.n(m.actionMetadata,y9d);g.MV(R,5);return g.S(R,Gsb(G,U,D.addedTimestampMillis,(T=q)==null?void 0:T.track,(a=q)==null?void 0:a.albumRelease),
7);case 7:k=Number(((Z=m.actionMetadata)==null?void 0:Z.priority)||0)+1;O=St("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",k,m4g);g.tU(R,6);break;case 5:K=g.fH(R);if(!(K instanceof Error&&K.message==="No data")){if(K instanceof Error&&K.message==="Empty response body")Ui(K.message);else return M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.qD&&K.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,M,t));R.sM(6);break}return g.S(R,tg(U,G.V,m,G.X),6);case 6:return R.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,O?[O]:void 0))}})},U4R=function(G,m){var w,W;
return g.h(function(U){switch(U.Y){case 1:return w=Oi(m),g.MV(U,2),W=g.Hd(m.entityKey).entityId,W==="!*$_ALL_ENTITIES_!*$"?g.S(U,dE(G.V,m,G.X),5):g.S(U,tg(W,G.V,m,G.X),6);case 6:return g.S(U,bTq(G.V,m.entityKey),5);case 5:g.tU(U,3);break;case 2:return g.fH(U),U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new PS("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},Gsb=function(G,m,w,W,U){var c,Q,D,O,q,T;
return g.h(function(a){switch(a.Y){case 1:if(c=W){a.sM(2);break}return g.S(a,fKn([m]),3);case 3:Q=a.V,D=Q[0],c=MyR(D);case 2:return g.S(a,smR(G,c,m,U,w),4);case 4:O=a.V;q=O.musicTrackEntity;T=O.sD;var Z=iY(q.thumbnailDetails),k=[];T&&(k=iY(T.thumbnailDetails));return g.S(a,Vk(Z.concat(k)),0)}})},smR=function(G,m,w,W,U){var c;
return g.h(function(Q){return Q.Y==1?(U||(U=Date.now().toString()),c={id:g.Yi(w,"musicTrackDownloadMetadataEntity"),playbackData:g.Yi(w,"playbackData"),addedTimestampMillis:U,videoDownloadContextEntity:g.Yi(w,"videoDownloadContextEntity")},W&&(m.albumRelease=W.id),g.S(Q,BD(G.V,{mode:"readwrite",p5:!0},function(D){var O=[],q=xd(D,c,"musicTrackDownloadMetadataEntity");O.push(q);q=xd(D,m,"musicTrack");O.push(q);W&&(D=xd(D,W,"musicAlbumRelease"),O.push(D));return g.KY.all(O)}),2)):Q.Y!=3?g.S(Q,ak(w,"musicTrackDownloadMetadataEntity",
G.V,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):Q.return({musicTrackEntity:m,
sD:W})})},yk=function(){uY.apply(this,arguments);
this.U="musicTrack"},cDq=function(G,m,w){m=m===void 0?43200:m;
w=w===void 0?!0:w;var W=W===void 0?!1:W;var U,c;return g.h(function(Q){switch(Q.Y){case 1:if(!G.K.Zc())return Q.return([]);U=[];g.MV(Q,2);return g.S(Q,hom(m,w,W),4);case 4:U=Q.V;g.tU(Q,3);break;case 2:g.fH(Q);case 3:return c=TDe(G,U,w,"musicPlaylist"),Q.return(c)}})},QmH=function(){g.bK.apply(this,arguments);
var G=this;this.events=new g.Mh(this);this.h4=this.player.S();this.VU={f2j:function(){return G.V},
u_:function(){return G.u_()},
tj:function(m){return G.tj(m)}}},vyH=function(G){var m;
G=g.n((m=G.getWatchNextResponse())==null?void 0:m.currentVideoEndpoint,g.L_);if(G==null?0:G.playlistId)var w=G.playlistId;return w},D4z=function(G,m){var w,W,U,c;
return g.h(function(Q){if(Q.Y==1){w=m.clientPlaybackNonce;W={cpn:w,offlineSourceVisualElement:g.iD(m.Pk||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};m.Y&&(W.videoFmt=Number(m.Y.itag));m.D&&(W.audioFmt=Number(m.D.itag));if((U=vyH(m))&&m.videoId){var D=m.videoId;D=U!=="PPSV"?Promise.resolve(!1):G.V.r9(D);Q=g.S(Q,D,3)}else Q=Q.sM(2);return Q}Q.Y!=2&&(c=Q.V)&&(W.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");G.Y=w;g.U3("offlinePlaybackStarted",W);g.VZ(Q)})};
g.nB.prototype.Xr=g.Uo(45,function(G){return this.app.Xr(G)});
g.is.prototype.Xr=g.Uo(44,function(G){return g.klB(this,9,G)});
g.I(lr,hR);g.so.Object.defineProperties(lr.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.V.entityMetadata},
set:function(G){this.V.entityMetadata=G}}});
g.I(XR4,lr);XR4.prototype.Y=function(){return[]};
g.I(yCH,lr);yCH.prototype.Y=function(){return[]};
g.I(GQm,lr);GQm.prototype.Y=function(){return[]};
g.I(mv9,lr);mv9.prototype.Y=function(){return[]};
g.I(wTR,lr);wTR.prototype.Y=function(){return[]};
g.I(Waq,lr);Waq.prototype.Y=function(){var G=[];this.V.alternateChannel&&G.push(this.V.alternateChannel);this.V.alternateChannelList&&G.push.apply(G,g.Z$(this.V.alternateChannelList));this.V.oneofChannelEntity&&G.push(this.V.oneofChannelEntity);return[].concat(g.Z$(new Set(G)))};
g.I(Uvf,lr);Uvf.prototype.Y=function(){var G=[];this.V.entryCollection&&G.push(this.V.entryCollection);return[].concat(g.Z$(new Set(G)))};
g.I(sWm,hR);sWm.prototype.Y=function(){var G=[];this.V.video&&G.push(this.V.video);return[].concat(g.Z$(new Set(G)))};
g.I(cem,lr);cem.prototype.Y=function(){var G=[];this.V.parentPlaylist&&G.push(this.V.parentPlaylist);if(this.V.entries)for(var m=g.V(this.V.entries),w=m.next();!w.done;w=m.next())G.push.apply(G,g.Z$((new sWm(w.value)).Y()));return[].concat(g.Z$(new Set(G)))};
g.I(QWH,lr);QWH.prototype.Y=function(){var G=[];this.V.descriptionEntity&&G.push(this.V.descriptionEntity);this.V.creators&&G.push.apply(G,g.Z$(this.V.creators));this.V.theBiggestFan&&G.push(this.V.theBiggestFan);return[].concat(g.Z$(new Set(G)))};
g.I(vIm,lr);vIm.prototype.Y=function(){return[]};
g.I(Dvz,lr);Dvz.prototype.Y=function(){return[]};
g.I(O2d,lr);O2d.prototype.Y=function(){return[]};
g.I(qpq,lr);qpq.prototype.Y=function(){return[]};
g.I(Tsd,lr);Tsd.prototype.Y=function(){return[]};
g.I($ve,lr);$ve.prototype.Y=function(){return[]};
g.I(aSH,lr);aSH.prototype.Y=function(){return[]};
g.I(Z2q,lr);Z2q.prototype.Y=function(){return[]};
g.I(kQq,lr);kQq.prototype.Y=function(){return[]};
g.I(i2H,lr);i2H.prototype.Y=function(){var G=[];this.V.downloadsList&&G.push(this.V.downloadsList);this.V.smartDownloadsList&&G.push(this.V.smartDownloadsList);this.V.recommendedDownloadsList&&G.push(this.V.recommendedDownloadsList);this.V.refresh&&G.push(this.V.refresh);return[].concat(g.Z$(new Set(G)))};
g.I(Kaf,hR);Kaf.prototype.Y=function(){var G=[];this.V.video&&G.push(this.V.video);this.V.playlist&&G.push(this.V.playlist);this.V.videoItem&&G.push(this.V.videoItem);this.V.playlistItem&&G.push(this.V.playlistItem);return[].concat(g.Z$(new Set(G)))};
g.I(Nsm,lr);Nsm.prototype.Y=function(){var G=[];this.V.refresh&&G.push(this.V.refresh);if(this.V.downloads)for(var m=g.V(this.V.downloads),w=m.next();!w.done;w=m.next())G.push.apply(G,g.Z$((new Kaf(w.value)).Y()));return[].concat(g.Z$(new Set(G)))};
g.I(ISf,lr);ISf.prototype.Y=function(){var G=[];this.V.localImageEntities&&G.push.apply(G,g.Z$(this.V.localImageEntities));return[].concat(g.Z$(new Set(G)))};
g.I(zYz,lr);zYz.prototype.Y=function(){var G=[];this.V.playbackData&&G.push(this.V.playbackData);this.V.localImageEntities&&G.push.apply(G,g.Z$(this.V.localImageEntities));this.V.videoDownloadContextEntity&&G.push(this.V.videoDownloadContextEntity);return[].concat(g.Z$(new Set(G)))};
g.I(VQg,lr);VQg.prototype.Y=function(){return[]};
g.I(MQq,lr);MQq.prototype.Y=function(){var G=[];this.V.fakeChildren&&G.push.apply(G,g.Z$(this.V.fakeChildren));return[].concat(g.Z$(new Set(G)))};
g.I(LaR,lr);LaR.prototype.Y=function(){var G=[];this.V.video&&G.push(this.V.video);this.V.playbackData&&G.push(this.V.playbackData);this.V.offlineVideoPolicy&&G.push(this.V.offlineVideoPolicy);return[].concat(g.Z$(new Set(G)))};
g.I(b2z,lr);b2z.prototype.Y=function(){return[]};
g.I(tQz,lr);tQz.prototype.Y=function(){var G=[];this.V.channelOwner&&G.push(this.V.channelOwner);this.V.videos&&G.push.apply(G,g.Z$(this.V.videos));this.V.collaboratorChannels&&G.push.apply(G,g.Z$(this.V.collaboratorChannels));this.V.downloadState&&G.push(this.V.downloadState);this.V.refresh&&G.push(this.V.refresh);return[].concat(g.Z$(new Set(G)))};
g.I(gIf,lr);gIf.prototype.Y=function(){var G=[];this.V.video&&G.push(this.V.video);this.V.channelContributor&&G.push(this.V.channelContributor);return[].concat(g.Z$(new Set(G)))};
g.I(dvn,hR);dvn.prototype.Y=function(){var G=[];this.V.localImageEntities&&G.push.apply(G,g.Z$(this.V.localImageEntities));this.V.videoDownloadContextEntity&&G.push(this.V.videoDownloadContextEntity);return[].concat(g.Z$(new Set(G)))};
g.I(fSe,hR);fSe.prototype.Y=function(){var G=[];this.V.recommendedVideoMetadata&&G.push.apply(G,g.Z$((new dvn(this.V.recommendedVideoMetadata)).Y()));return[].concat(g.Z$(new Set(G)))};
g.I(RYq,hR);RYq.prototype.Y=function(){var G=[];this.V.playbackPosition&&G.push(this.V.playbackPosition);return[].concat(g.Z$(new Set(G)))};
g.I(pTH,lr);pTH.prototype.Y=function(){var G=[];this.V.owner&&G.push(this.V.owner);this.V.downloadState&&G.push(this.V.downloadState);this.V.userState&&G.push.apply(G,g.Z$((new RYq(this.V.userState)).Y()));this.V.additionalMetadata&&G.push.apply(G,g.Z$((new fSe(this.V.additionalMetadata)).Y()));return[].concat(g.Z$(new Set(G)))};
g.I(jW4,lr);jW4.prototype.Y=function(){var G=[];this.V.userChannelDetails&&G.push(this.V.userChannelDetails);return[].concat(g.Z$(new Set(G)))};
g.I(Sp9,lr);Sp9.prototype.Y=function(){var G=[];this.V.channelOwner&&G.push(this.V.channelOwner);this.V.playbackPosition&&G.push(this.V.playbackPosition);this.V.localImageEntities&&G.push.apply(G,g.Z$(this.V.localImageEntities));this.V.downloadStatus&&G.push(this.V.downloadStatus);return[].concat(g.Z$(new Set(G)))};
g.I(PZH,lr);PZH.prototype.Y=function(){return[]};
g.I(oIR,lr);oIR.prototype.Y=function(){return[]};
g.I(hYg,lr);hYg.prototype.Y=function(){return[]};
g.I(lSz,lr);lSz.prototype.Y=function(){return[]};
g.I(CZH,lr);CZH.prototype.Y=function(){return[]};
g.I(EIq,lr);EIq.prototype.Y=function(){return[]};
g.I(Jee,lr);Jee.prototype.Y=function(){return[]};
g.I(re4,lr);re4.prototype.Y=function(){return[]};
g.I(FaH,lr);FaH.prototype.Y=function(){return[]};
g.I(eYn,lr);eYn.prototype.Y=function(){return[]};
g.I(nIb,lr);nIb.prototype.Y=function(){return[]};
g.I(xvb,lr);xvb.prototype.Y=function(){return[]};
g.I(ugH,lr);ugH.prototype.Y=function(){var G=[];this.V.trackDownloadMetadatas&&G.push.apply(G,g.Z$(this.V.trackDownloadMetadatas));return[].concat(g.Z$(new Set(G)))};
g.I(H2c,lr);
H2c.prototype.Y=function(){var G=[];this.V.downloadedTracks&&G.push.apply(G,g.Z$(this.V.downloadedTracks));this.V.smartDownloadedTracks&&G.push.apply(G,g.Z$(this.V.smartDownloadedTracks));this.V.downloadedEpisodes&&G.push.apply(G,g.Z$(this.V.downloadedEpisodes));this.V.downloadedAlbumReleases&&G.push.apply(G,g.Z$(this.V.downloadedAlbumReleases));this.V.smartDownloadedAlbumReleases&&G.push.apply(G,g.Z$(this.V.smartDownloadedAlbumReleases));this.V.downloadedPlaylists&&G.push.apply(G,g.Z$(this.V.downloadedPlaylists));this.V.smartDownloadedPlaylists&&
G.push.apply(G,g.Z$(this.V.smartDownloadedPlaylists));this.V.metadataOnlyTracks&&G.push.apply(G,g.Z$(this.V.metadataOnlyTracks));return[].concat(g.Z$(new Set(G)))};
g.I(Ypq,lr);Ypq.prototype.Y=function(){var G=[];this.V.trackDownloadMetadatas&&G.push.apply(G,g.Z$(this.V.trackDownloadMetadatas));return[].concat(g.Z$(new Set(G)))};
g.I(Bsd,lr);Bsd.prototype.Y=function(){var G=[];this.V.playbackData&&G.push(this.V.playbackData);this.V.localImageEntities&&G.push.apply(G,g.Z$(this.V.localImageEntities));this.V.videoDownloadContextEntity&&G.push(this.V.videoDownloadContextEntity);return[].concat(g.Z$(new Set(G)))};
g.I(Aed,lr);Aed.prototype.Y=function(){var G=[];this.V.musicLibraryStatusEntity&&G.push(this.V.musicLibraryStatusEntity);this.V.primaryArtists&&G.push.apply(G,g.Z$(this.V.primaryArtists));this.V.details&&G.push(this.V.details);this.V.userDetails&&G.push(this.V.userDetails);this.V.tracks&&G.push.apply(G,g.Z$(this.V.tracks));this.V.share&&G.push(this.V.share);this.V.downloadMetadata&&G.push(this.V.downloadMetadata);this.V.refresh&&G.push(this.V.refresh);return[].concat(g.Z$(new Set(G)))};
g.I(XTf,lr);XTf.prototype.Y=function(){var G=[];this.V.albumRelease&&G.push(this.V.albumRelease);this.V.tracks&&G.push.apply(G,g.Z$(this.V.tracks));return[].concat(g.Z$(new Set(G)))};
g.I(yez,lr);yez.prototype.Y=function(){var G=[];this.V.albumRelease&&G.push(this.V.albumRelease);return[].concat(g.Z$(new Set(G)))};
g.I(GGR,lr);GGR.prototype.Y=function(){var G=[];this.V.details&&G.push(this.V.details);this.V.userDetails&&G.push(this.V.userDetails);return[].concat(g.Z$(new Set(G)))};
g.I(m9R,lr);m9R.prototype.Y=function(){var G=[];this.V.parentArtist&&G.push(this.V.parentArtist);return[].concat(g.Z$(new Set(G)))};
g.I(w54,lr);w54.prototype.Y=function(){var G=[];this.V.parentArtist&&G.push(this.V.parentArtist);return[].concat(g.Z$(new Set(G)))};
g.I(Wtc,lr);Wtc.prototype.Y=function(){return[]};
g.I(U94,lr);U94.prototype.Y=function(){return[]};
g.I(svf,hR);svf.prototype.Y=function(){var G=[];this.V.creatorEntity&&G.push(this.V.creatorEntity);return[].concat(g.Z$(new Set(G)))};
g.I(c_g,lr);
c_g.prototype.Y=function(){var G=[];this.V.tracks&&G.push.apply(G,g.Z$(this.V.tracks));this.V.refresh&&G.push(this.V.refresh);this.V.musicLibraryStatusEntity&&G.push(this.V.musicLibraryStatusEntity);this.V.details&&G.push(this.V.details);this.V.downloadMetadata&&G.push(this.V.downloadMetadata);this.V.sideloadMetadata&&G.push(this.V.sideloadMetadata);this.V.userDetails&&G.push(this.V.userDetails);this.V.entryCollection&&G.push(this.V.entryCollection);this.V.share&&G.push(this.V.share);this.V.podcastShowAdditionalMetadata&&
G.push.apply(G,g.Z$((new svf(this.V.podcastShowAdditionalMetadata)).Y()));return[].concat(g.Z$(new Set(G)))};
g.I(Qvz,lr);Qvz.prototype.Y=function(){return[]};
g.I(v8g,lr);
v8g.prototype.Y=function(){var G=[];this.V.musicLibraryStatusEntity&&G.push(this.V.musicLibraryStatusEntity);this.V.artists&&G.push.apply(G,g.Z$(this.V.artists));this.V.audioModeVersion&&G.push(this.V.audioModeVersion);this.V.videoModeVersion&&G.push(this.V.videoModeVersion);this.V.userDetails&&G.push(this.V.userDetails);this.V.details&&G.push(this.V.details);this.V.albumRelease&&G.push(this.V.albumRelease);this.V.share&&G.push(this.V.share);this.V.libraryEdit&&G.push(this.V.libraryEdit);this.V.downloadMetadata&&
G.push(this.V.downloadMetadata);this.V.playbackPosition&&G.push(this.V.playbackPosition);this.V.lyrics&&G.push(this.V.lyrics);return[].concat(g.Z$(new Set(G)))};
g.I(D9q,lr);D9q.prototype.Y=function(){var G=[];this.V.parentTrack&&G.push(this.V.parentTrack);return[].concat(g.Z$(new Set(G)))};
g.I(OqR,lr);OqR.prototype.Y=function(){var G=[];this.V.parentTrack&&G.push(this.V.parentTrack);return[].concat(g.Z$(new Set(G)))};
g.I(qKq,lr);qKq.prototype.Y=function(){return[]};
g.I(T8H,lr);T8H.prototype.Y=function(){return[]};
g.I($99,lr);$99.prototype.Y=function(){return[]};
g.I(ax9,lr);ax9.prototype.Y=function(){return[]};
g.I(Zq4,lr);Zq4.prototype.Y=function(){var G=[];this.V.transfer&&G.push(this.V.transfer);this.V.adsPlaybackData&&G.push.apply(G,g.Z$(this.V.adsPlaybackData));this.V.drmLicense&&G.push(this.V.drmLicense);this.V.offlineVideoPolicy&&G.push(this.V.offlineVideoPolicy);this.V.videoDownloadContextEntity&&G.push(this.V.videoDownloadContextEntity);return[].concat(g.Z$(new Set(G)))};
g.I(kGH,lr);kGH.prototype.Y=function(){return[]};
g.I(iqd,lr);iqd.prototype.Y=function(){var G=[];this.V.offlineVideoStreams&&G.push.apply(G,g.Z$(this.V.offlineVideoStreams));this.V.captionTrack&&G.push.apply(G,g.Z$(this.V.captionTrack));return[].concat(g.Z$(new Set(G)))};
g.I(KtR,lr);KtR.prototype.Y=function(){return[]};
g.I(N8g,lr);N8g.prototype.Y=function(){return[]};
g.I(Ixf,lr);Ixf.prototype.Y=function(){return[]};
g.I(z_d,lr);z_d.prototype.Y=function(){return[]};
g.I(VYR,lr);VYR.prototype.Y=function(){return[]};
g.I(MYH,lr);MYH.prototype.Y=function(){return[]};
g.I(Ltq,lr);Ltq.prototype.Y=function(){return[]};
g.I(bqb,lr);bqb.prototype.Y=function(){return[]};
g.I(tYz,lr);tYz.prototype.Y=function(){return[]};
g.I(g8b,lr);g8b.prototype.Y=function(){return[]};
g.I(d9d,lr);d9d.prototype.Y=function(){return[]};
g.I(fxH,lr);fxH.prototype.Y=function(){return[]};
g.I(R_H,lr);R_H.prototype.Y=function(){return[]};
g.I(p5q,lr);p5q.prototype.Y=function(){return[]};
g.I(jvH,lr);jvH.prototype.Y=function(){return[]};
g.I(SKq,lr);SKq.prototype.Y=function(){return[]};
g.I(POd,lr);POd.prototype.Y=function(){return[]};
g.I(o8R,lr);o8R.prototype.Y=function(){return[]};
g.I(h_R,lr);h_R.prototype.Y=function(){return[]};
g.I(lx9,lr);lx9.prototype.Y=function(){return[]};
g.I(CO9,lr);CO9.prototype.Y=function(){return[]};
var lKc=["browse","music/browse","unplugged/browse"],F3m=["offline/playlist_sync_check"],dqd=["offline"],C3c=["offline/offline_video_playback_position_sync"],JYm=["offline/get_playback_data_entity"],Cl;EM.getInstance=function(){return g.h(function(G){return G.return(new Promise(function(m){g.HL().then(function(w){w?(EM.instance||(EM.instance=new EM(w)),m(EM.instance)):m(void 0)})}))})};
EM.prototype.get=function(G){var m=this,w,W,U;return g.h(function(c){if(c.Y==1)return g.S(c,FtH(m.token),2);if(c.Y!=3)return w=c.V,g.S(c,w.get("prefs",G),3);W=c.V;if(!W)return c.return();U=(0,g.V6)();return W.expirationTimestampMs<=U?c.return():c.return(W.value)})};
EM.prototype.set=function(G,m,w){w=w===void 0?31536E3:w;var W=this,U,c,Q;return g.h(function(D){if(D.Y==1)return U=(0,g.V6)(),c={key:G,value:m,expirationTimestampMs:U+w*1E3},g.S(D,FtH(W.token),2);Q=D.V;return g.S(D,g.fY(Q,"prefs",c),0)})};
EM.prototype.remove=function(G){var m=this,w;return g.h(function(W){if(W.Y==1)return g.S(W,FtH(m.token),2);w=W.V;return g.S(W,w.delete("prefs",G),0)})};
g.I(JR,g.J0);g.I(rW,HqH);rW.prototype.X=function(G,m){m=B8n(m);G=(new TextEncoder).encode(JSON.stringify(G));return this.V.encrypt(G,m)};
rW.prototype.Y=function(G,m){if(!(G instanceof Uint8Array))throw e_q(1);var w=new TextDecoder;m=B8n(m);G=this.V.decrypt(G,m);return JSON.parse(w.decode(G))};
var A_c={accountLinkStatusEntity:O2d,booleanEntity:mv9,buttonEntity:p5q,captionTrack:qKq,channelHandle:XR4,chipEntity:Ltq,commerceAcquisitionClientPayloadEntity:SKq,commerceCartListEntity:POd,contextNoteFeedEntityPayload:yCH,contextNoteUserRatingEntityPayload:GQm,continuationTokenEntity:b2z,downloadQualityPickerEntity:aSH,downloadsPageRefreshTokenEntity:kQq,downloadsPageViewConfigurationEntity:PZH,downloadStatusEntity:Z2q,dismissState:bqb,sfvAudioItemCurrentlyPlayingEntity:z_d,emojiFountainDataEntity:fxH,
emojiCustomizationSetEntity:d9d,fakeChannel:Waq,fakePlaylist:Uvf,fakePlaylistEntryCollection:cem,fakeVideo:QWH,fakeVideoDescription:vIm,featuredProductsEntity:eYn,flowStateEntity:Dvz,iconBadgeEntity:o8R,interstitialInteractionStateEntity:Tsd,likeButtonAnimationEntity:oIR,liveChatPollStateEntity:$ve,liveViewerLeaderboardChatEntryPointStateEntity:N8g,liveViewerLeaderboardPointsEntity:Ixf,liveReactionsDataEntity:R_H,logoEntity:qpq,macroMarkerEntity:hYg,mainDownloadsLibraryEntity:i2H,mainDownloadsListEntity:Nsm,
mainPlaylistDownloadStateEntity:ISf,mainPlaylistEntity:tQz,mainPlaylistVideoEntity:gIf,mainVideoDownloadStateEntity:zYz,mainVideoEntity:pTH,markersEngagementPanelSyncEntity:lSz,markersVisibilityOverrideEntity:CZH,musicAlbumReleaseDetail:XTf,musicAlbumReleaseDownloadMetadataEntity:ugH,musicAlbumRelease:Aed,musicAlbumReleaseUserDetail:yez,musicArtistDetail:m9R,musicArtist:GGR,musicArtistUserDetail:w54,musicDownloadsLibraryEntity:H2c,musicLibraryEdit:Wtc,musicLibraryStatusEntity:U94,musicPlaylist:c_g,
musicPlaylistDownloadMetadataEntity:Ypq,musicShare:Qvz,musicTrackDetail:D9q,musicTrackDownloadMetadataEntity:Bsd,musicTrack:v8g,musicTrackUserDetail:OqR,offlineOrchestrationActionWrapperEntity:T8H,offlineVideoPolicy:$99,offlineVideoStreams:ax9,offlineabilityEntity:VQg,orchestrationWebSamplingEntity:MQq,pageHeaderEntity:tYz,pdpStateEntity:h_R,pinnedProductEntity:nIb,playbackData:Zq4,playerStateEntity:EIq,quantityIncrementerEntity:lx9,refresh:kGH,saveToPlaylistListEntity:VYR,selectedChipIndexEntityPayload:Jee,
settingEntity:MYH,stringEntity:wTR,suggestedFeedbackChipStateEntity:re4,transfer:iqd,trendingOfferEntity:xvb,videoDownloadContextEntity:KtR,videoOverviewAsyncDataEntity:CO9,videoPlaybackPositionEntity:jvH,votingEntity:g8b,ytMainChannelEntity:jW4,youchatPendingResponseEntity:FaH,ytMainDownloadedVideoEntity:LaR,ytMainVideoEntity:Sp9};g.I(HD,HqH);HD.prototype.X=function(G){return G};
HD.prototype.Y=function(G){if(G instanceof Uint8Array)throw e_q(0);return G};
g.I(Yd,g.J);Yd.prototype.observe=function(G){var m=this;this.observers.push(G);return function(){var w=m.observers.indexOf(G);w>=0&&m.observers.splice(w,1)}};
Yd.prototype.Y=function(G){qlH(this,G.data)};
Yd.prototype.Hk=function(){this.channel.close()};
var kAc,aKb=new g.Iw("elementsCommand");var L7=new g.Iw("entityBatchUpdate");var wvH=new g.Iw("downloadStatusEntity");var KGd=new g.Iw("mainPlaylistEntityActionMetadata");var BS=new g.Iw("mainVideoEntityActionMetadata");var gEq=new g.Iw("musicPlaylistEntityActionMetadata");var y9d=new g.Iw("musicTrackEntityActionMetadata");var Sn9=new g.Iw("localImageEntityActionMetadata");var ok=new g.Iw("playbackDataActionMetadata");var ZGg=new g.Iw("transferEntityActionMetadata");var Gbz=new g.Iw("videoPlaybackPositionEntityActionMetadata");var pEq;new g.Da;new g.Da;hP9.prototype.request=function(G,m,w){m=m===void 0?{}:m;return this.locks.request(G,m,function(W){return w(W)})};var WS=g.X6.caches,wE,r3g;mV.prototype.open=function(G){return WS.open(E9m(G))};
mV.prototype.has=function(G){return WS.has(E9m(G))};
mV.prototype.delete=function(G){return WS.delete(E9m(G))};
mV.prototype.match=function(G,m){var w=this,W,U,c,Q,D,O;return g.h(function(q){switch(q.Y){case 1:return g.S(q,w.keys(),2);case 2:W=q.V,U=g.V(W),c=U.next();case 3:if(c.done){q.sM(5);break}Q=c.value;return g.S(q,w.open(Q),6);case 6:return D=q.V,g.S(q,D.match(G,m),7);case 7:if(O=q.V)return q.return(O);c=U.next();q.sM(3);break;case 5:return q.return()}})};
g.I(CcH,mV);CcH.prototype.keys=function(){var G,m,w,W,U,c,Q,D,O;return g.h(function(q){if(q.Y==1)return G=[],m=g.re("CacheStorage keys"),g.S(q,WS.keys(),2);w=q.V;W=g.V(w);for(U=W.next();!U.done;U=W.next()){c=U.value;var T=c.indexOf(":");Q=T===-1?{mK:c}:{mK:c.substring(0,T),datasyncId:c.substring(T+1)};D=Q.mK;O=Q.datasyncId;O===m&&G.push(D)}return q.return(G)})};g.I(si,g.J);si.prototype.X=function(G){this.api.G2("onOfflineOperationFailure",G.data)};
si.prototype.D=function(G){this.api.publish("offlinetransferpause",G.data)};
si.prototype.Hk=function(){var G;(G=this.V)==null||G.close();var m;(m=this.Y)==null||m.close()};n9q.prototype.wx=function(){this.V&&Qk(this)};
n9q.prototype.N0=function(){this.Y&&this.Y.resolve();this.X=this.V=!1;this.U()};var pjg=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var qkc="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Vyb="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.I(nEq,jt);nEq.prototype.Y=function(G){return qd(G)?HTg(this,G):TY(G)?AYR(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};g.I(XvH,jt);XvH.prototype.Y=function(G){return TY(G)?yYe(this,G):mqf(G)?mSn(this,G):$v(G)?wjH(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};g.N=WB9.prototype;g.N.H56=function(G){var m=this,w,W,U,c;return g.h(function(Q){if(!g.H(G.state,128))return Q.sM(0);w=G.state.w0;var D=(W=w)==null?void 0:W.errorCode,O=(U=w)==null?void 0:U.Vf;c=D==="net.connect"&&O===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(D==null?0:D.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.S(Q,m.gj(m.player.getVideoData().videoId,c),0)})};
g.N.gj=function(G,m){var w=this;return g.h(function(W){if(W.Y==1){if(w.Y)return W.return();w.Y=!0;return m==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(C7(w,G,!1,!0),W.sM(0)):g.S(W,lY(w,G),3)}g.s8(G,4);return g.S(W,w.V.gj(m),0)})};
g.N.f1=function(G){G.status===2?(G.status!==this.X&&(ypm(this.V),g.s8(G.videoId,2)),G.Ev&&UHH(this.V,G.videoId,G.Ev)):G.status===4?(lY(this,G.videoId),this.gj(G.videoId,G.b5?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):G.status===1&&WGz(this.V);this.X=G.status;this.api.G2("localmediachange",{videoId:G.videoId,status:G.status})};
g.N.TV=function(){var G=this,m;return g.h(function(w){if(w.Y==1){if(G.Y)return w.return();G.Y=!0;m=G.player.getVideoData().videoId;return g.S(w,lY(G,m),2)}return g.S(w,G.V.TV(),0)})};
g.N.sO=function(G){switch(G){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.N.J=function(G){return this.api.S().J(G)};g.I(OGR,jt);OGR.prototype.Y=function(G){return qd(G)?TVH(this,G):TY(G)?$Sq(this,G):mqf(G)?aw4(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};IwR.prototype.V=function(G,m){var w=G.action.actionMetadata.priority-m.action.actionMetadata.priority;w===0&&(G.V<m.V?w=-1:G.V>m.V&&(w=1));return w};g.I(Ei,g.J);Ei.prototype.Hk=function(){this.U&&this.U();g.J.prototype.Hk.call(this)};
Ei.prototype.createAction=function(G,m){var w=g.Hd(G.entityKey).entityType,W=g.iy(16);return new K7(w,W,G,m.actionId,m.rootActionId)};
Ei.prototype.D6=function(G){var m=this,w,W,U,c,Q,D,O,q,T;return g.h(function(a){if(a.Y==1){if(m.i6())return a.return();W=(w=G.offlineOrchestrationActionWrapperEntity)!=null?w:new Set;U=[];c=g.V(W);for(Q=c.next();!Q.done;Q=c.next())D=Q.value,O=g.Hd(D),q=O.entityId,MAH(m.V,q)||U.push(D);return g.S(a,Plm(m,U),2)}T=a.V;return g.S(a,SNR(m,T),0)})};
Ei.prototype.retry=function(){var G=this;return g.h(function(m){return g.S(m,ojq(G),0)})};lwg.prototype.A0=function(G,m){m=m===void 0?!0:m;var w=this,W,U,c,Q,D,O,q,T;return g.h(function(a){switch(a.Y){case 1:if(!w.V)return a.return();W=[];U=g.sQ(w.V.Y,m);c=[];for(Q={fb:0};Q.fb<U.length;Q={fb:Q.fb},Q.fb++)D=U[Q.fb],O=w.V.gq(D,"json3"),q=g.M4(O,{withCredentials:!0,format:"RAW"},3,500).then(function(Z){return function(k){k={metadata:g.eL(U[Z.fb]),trackData:k.xhr.responseText};c.push(k)}}(Q)).d7(function(Z){Ui("Caption fetch error",Z)}),W.push(q);
return g.S(a,ACb(W),2);case 2:return g.MV(a,3),g.S(a,L6H(G,c),5);case 5:g.tU(a,0);break;case 3:T=g.fH(a),Ui("Caption DB transaction error",T),g.VZ(a)}})};g.I(Jg,g.J);Jg.prototype.Hk=function(){this.Y&&this.Y();g.J.prototype.Hk.call(this)};
Jg.prototype.X=function(G){var m=this,w,W,U,c,Q,D,O,q;return g.h(function(T){W=(w=G.transfer)!=null?w:new Set;U=[];c=g.V(W);for(Q=c.next();!Q.done;Q=c.next())D=Q.value,O=g.Hd(D),q=O.entityId,U.push(q);return U.length===0?T.return():g.S(T,Jpb(m,U),0)})};g.I(xSb,g.J);g.N=xSb.prototype;g.N.Hk=function(){this.M9&&this.M9();this.J4.dispose();this.D.dispose();this.Pk&&g.YI(this.K.qv,this.Pk);this.pM&&g.YI(this.K.qv,this.pM);g.J.prototype.Hk.call(this)};
g.N.SQE=function(G){var m=this,w,W,U;return g.h(function(c){switch(c.Y){case 1:w=g.Yi(G,"transfer");if(m.V&&w===m.V.key){C7(m.L,m.j,!0);m.D.stop();c.sM(0);break}return g.S(c,BD(m.Y,{mode:"readwrite",p5:!0},function(Q){return Fi(Q,w,"transfer").then(function(D){if(D&&D.transferState!=="TRANSFER_STATE_COMPLETE"&&D.transferState!=="TRANSFER_STATE_FAILED")return D.transferState="TRANSFER_STATE_PAUSED_BY_USER",xd(Q,D,"transfer").then(function(){return D})})}),3);
case 3:W=c.V;if(!W){c.sM(0);break}if(!G||!m.X){c.sM(5);break}return g.S(c,ak(G,m.X,m.Y,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.S(c,et(m,G),7);case 7:U=c.V,y3c({videoId:G,xw:W,offlineModeType:U}),g.VZ(c)}})};
g.N.Wsp=function(){var G=this;if(this.V&&this.j){C7(this.L,this.j,!1);var m=this.V,w=(m==null?0:m.key)?g.Hd(m.key).entityId:"";w&&this.X&&(new Promise(function(W,U){ak(w,G.X,G.Y,"DOWNLOAD_STATE_PAUSED").catch(function(c){U(c)})})).catch(function(W){Ui("Download state setting error",W)})}this.D.stop()};
g.N.V3=function(){this.V?YNg(this,this.V):FF(this)};
g.N.hZ=function(G){var m=this;return g.h(function(w){switch(w.Y){case 1:if(!m.V){w.sM(2);break}if(m.V.transferState==="TRANSFER_STATE_COMPLETE"||m.V.transferState==="TRANSFER_STATE_FAILED"||!G.transfer||!G.transfer.has(m.V.key)){w.sM(3);break}return g.S(w,Xi(m.Y,m.V.key,"transfer"),4);case 4:m.V=w.V;if(m.V){w.sM(3);break}return g.S(w,BVb(m),3);case 3:if(m.V)return w.return();case 2:return g.S(w,FF(m),0)}})};
g.N.gj=function(G,m){var w=this,W,U,c,Q,D;return g.h(function(O){switch(O.Y){case 1:if(!w.V){n7(w,"onTransferFailure: "+G);O.sM(2);break}W=w.V;c=((U=W)==null?0:U.key)?g.Hd(W.key).entityId:"";a:switch(G){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var q=!1;break a;default:q=!0}return q&&swn(w)?g.S(O,xv(w,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.S(O,
c9H(w,G),5);case 5:if(!c||!w.X){O.sM(2);break}return g.S(O,ak(c,w.X,w.Y,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.S(O,et(w,c),9);case 9:Q=O.V;Dr({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:c,xw:W,offlineModeType:Q});if(!c||!w.X){O.sM(2);break}return g.S(O,ak(c,w.X,w.Y,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:rE(w),D=FF(w,!0),m&&m(D),g.VZ(O)}})};
g.N.TV=function(G){var m=this,w,W,U,c,Q,D,O,q,T,a,Z,k;return g.h(function(K){switch(K.Y){case 1:if(!m.V){n7(m,"onMaybeTransferStreamsExpired");K.sM(2);break}return swn(m)?g.S(K,xv(m,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.S(K,c9H(m,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!m.X){K.sM(2);break}w=m.V;U=((W=w)==null?0:W.key)?g.Hd(w.key).entityId:"";if(!U){K.sM(2);break}return g.S(K,ak(U,m.X,m.Y,"DOWNLOAD_STATE_FAILED"),2);case 9:return m.V||n7(m,"onMaybeTransferStreamsExpiredRetryAttempting"),
c=m.V,D=((Q=c)==null?0:Q.key)?g.Hd(c.key).entityId:"",g.S(K,et(m,D),10);case 10:return O=K.V,Dr({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:D,xw:c,offlineModeType:O}),q=sic(),g.P7(q,ok,{isEnqueuedForExpiredStreamUrlRefetch:!0}),T=g.Yi(D,"playbackData"),a={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:T,actionMetadata:q},Z=Ik(new K7("playbackData",D,a)),g.S(K,AR(m.Y,Z,"offlineOrchestrationActionWrapperEntity"),2);case 2:rE(m),k=FF(m,!0),
G&&G(k),g.VZ(K)}})};
var OKd={},Qwn=(OKd.TRANSFER_STATE_TRANSFERRING=1,OKd.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,OKd);g.N=uY.prototype;g.N.f$=function(){return this.j.promise};
g.N.Uu=function(){if(this.Y&&this.L)return this.j.promise;OXf(this).then(this.j.resolve).catch(this.j.reject);return this.j.promise};
g.N.mz=function(G){var m={};return m.playbackData=new nEq(G,this.h4,this.V),m.transfer=new OGR(G,this.h4),m.videoPlaybackPositionEntity=new XvH(G,this.h4),m};
g.N.Dt=function(){var G=this;return g.h(function(m){return G.Y?g.S(m,uqd(G.Y),0):m.sM(0)})};
g.N.Vh=function(){var G=this,m,w;return g.h(function(W){if(W.Y==1)return G.Y||G.L?g.S(W,G.f$(),2):W.return();G.C!==void 0&&(g.Ts(G.C),G.C=void 0);G.D!==void 0&&(g.Ts(G.D),G.D=void 0);(m=G.Y)==null||m.dispose();G.Y=void 0;(w=G.L)==null||w.dispose();G.L=void 0;G.api.G2("onOrchestrationLostLeader");G.j=new g.Da;g.VZ(W)})};
g.N.isOrchestrationLeader=function(){return this.X.V};
g.N.r9=function(){return g.h(function(G){return G.return(!1)})};
g.N.BZ=function(G){var m=this.V;m.api.publish("offlinetransferpause",G);var w;(w=m.Y)==null||w.postMessage(G)};
g.N.V3=function(G){var m,w;return g.h(function(W){if(W.Y==1)return g.S(W,GY(),2);m=W.V;if(!m)return W.return();w=g.Yi(G,"transfer");return g.S(W,BD(m,{mode:"readwrite",p5:!0},function(U){var c=Fi(U,w,"transfer"),Q=Fi(U,g.Yi(G,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.KY.all([c,Q]).then(function(D){D=g.V(D);var O=D.next().value;var q=D.next().value;return O&&O.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(O.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",xd(U,O,"transfer").then(function(){Dr({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:G,xw:O,offlineModeType:q==null?void 0:q.offlineModeType});return g.KY.resolve(null)})):g.KY.resolve(null)})}),0)})};
g.N.F3=function(G){G=G===void 0?43200:G;var m=this,w,W,U,c,Q,D,O,q;return g.h(function(T){if(T.Y==1)return m.K.Zc()?g.S(T,GY(),2):T.return(qnz());if(T.Y!=3){w=T.V;if(!w)return T.return([]);W=Date.now()/1E3;return g.S(T,yB(w,"offlineVideoPolicy"),3)}U=T.V;c=[];Q=g.V(U);for(D=Q.next();!D.done;D=Q.next())O=D.value,Number(O.lastUpdatedTimestampSeconds)+G<=W&&(q=g.Hd(O.key).entityId,c.push(q));return c.length?T.return(HS(m,c,m.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):T.return([])})};
g.N.deleteAll=function(){return HS(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.N.refreshAllStaleEntities=function(G){var m=this;return g.h(function(w){return w.Y==1?g.S(w,m.F3(G),2):w.return(w.V)})};
g.N.setUpPositionSyncInterval=function(G){var m=this;this.D!==void 0&&(g.Ts(this.D),this.D=void 0);var w=G!=null?G:864E5;this.D=g.Oh(function(){m.XX(w)},w)};
g.N.XX=function(G){var m=this,w,W,U,c,Q,D;return g.h(function(O){switch(O.Y){case 1:return g.MV(O,2),g.S(O,EM.getInstance(),4);case 4:w=O.V;if(!w)throw Error("prefStorage is undefined");return g.S(O,w.get("psi"),5);case 5:W=O.V;c=((U=W)==null?0:U.S_)?Number(W.S_)/1E3:0;Q=Date.now();if(!(c+G<=Q)){O.sM(6);break}return g.S(O,HS(m,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.tU(O,0);break;case 2:D=g.fH(O),Ui("Offline manager error",D),
g.VZ(O)}})};
g.N.hs=function(){var G=this,m,w,W,U,c,Q,D;return g.h(function(O){if(O.Y==1)return g.S(O,GY(),2);if(O.Y!=3)return(m=O.V)?g.S(O,yB(m,"transfer"),3):O.return([]);w=O.V;W=[];U=g.V(w);for(c=U.next();!c.done;c=U.next())Q=c.value,Q.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&Q.key&&(D=g.Hd(Q.key).entityId,W.push(D));return O.return($Hd(G,W))})};
g.N.XB=function(){return g.h(function(G){return G.return([])})};
g.N.Yy=function(){return g.h(function(G){g.VZ(G)})};
g.N.R9=function(){return g.h(function(G){g.VZ(G)})};g.I(aEq,jt);aEq.prototype.Y=function(G){return qd(G)?iX4(this,G):TY(G)?ND4(this,G):$v(G)?IEH(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var Yv=[10];g.I(bXd,jt);bXd.prototype.Y=function(G){return qd(G)?dH9(this,G):TY(G)?fE4(this,G):$v(G)?R$q(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var g49=[10];g.I(jw9,jt);jw9.prototype.Y=function(G){return TY(G)?P64(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};g.I(o44,uY);g.N=o44.prototype;g.N.mz=function(G){var m=uY.prototype.mz.call(this,G);m.mainVideoEntity=new bXd(G,this.h4,this.V);m.mainPlaylistEntity=new aEq(G,this.h4,this.V);m.mainDownloadsListEntity=new jw9(G,this.h4,this.V);return m};
g.N.refreshAllStaleEntities=function(G,m){var w=this,W,U,c,Q,D,O,q,T,a,Z,k;return g.h(function(K){switch(K.Y){case 1:W=[];if(!w.h4.J("web_player_offline_playlist_auto_refresh")){K.sM(2);break}return g.S(K,h$4(w,G,m),3);case 3:W=K.V;case 2:return g.S(K,EM.getInstance(),4);case 4:return U=K.V,g.S(K,(c=U)==null?void 0:c.get("sdois"),5);case 5:return Q=K.V,g.S(K,(D=U)==null?void 0:D.get("lmqf"),6);case 6:O=K.V;if(!Q){K.sM(7);break}T=W;a=T.concat;return g.S(K,lEm(w,Q,(q=O)!=null?q:"SD",G===0),8);case 8:W=
a.call(T,K.V);case 7:return Z=W,k=Z.concat,g.S(K,uY.prototype.refreshAllStaleEntities.call(w,G,m),9);case 9:return W=k.call(Z,K.V),K.return(W)}})};
g.N.r9=function(G){var m,w,W,U,c,Q,D,O;return g.h(function(q){if(q.Y==1)return g.S(q,GY(),2);if(q.Y!=3)return(m=q.V)?g.S(q,Xi(m,g.lf,"mainDownloadsListEntity"),3):q.return(!1);w=q.V;if((W=w)==null?0:(U=W.downloads)==null?0:U.length)for(c=g.Yi(G,"mainVideoEntity"),Q=g.V(w.downloads),D=Q.next();!D.done;D=Q.next())if(O=D.value,O.videoItem===c)return q.return(!0);return q.return(!1)})};
g.N.XB=function(){var G=this,m,w,W,U,c,Q,D,O;return g.h(function(q){if(q.Y==1)return g.S(q,GY(),2);if(q.Y!=3)return(m=q.V)?g.S(q,yB(m,"downloadStatusEntity"),3):q.return([]);w=q.V;W=[];U=g.V(w);for(c=U.next();!c.done;c=U.next())Q=c.value,Q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&Q.key&&(D=g.Hd(Q.key).entityId,W.push(D));return W.length?(O={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},q.return(HS(G,W,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
O))):q.return([])})};
g.N.R9=function(){var G;return g.h(function(m){return m.Y==1?g.S(m,GY(),2):(G=m.V)?g.S(m,BD(G,{mode:"readwrite",p5:!0},function(w){return en(w,"mainVideoEntity").then(function(W){var U=[];W=g.V(W);for(var c=W.next();!c.done;c=W.next()){c=c.value;var Q=void 0;(Q=c.userState)!=null&&Q.playbackPosition||(Q=g.Hd(c.key).entityId,Q={key:g.Yi(Q,"videoPlaybackPositionEntity"),videoId:Q,lastPlaybackPositionSeconds:"0"},U.push(xd(w,Q,"videoPlaybackPositionEntity")),c.userState={playbackPosition:Q.key},U.push(xd(w,
c,"mainVideoEntity")))}return g.KY.all(U)})}),0):m.return()})};
g.N.Yy=function(){var G,m,w,W,U,c,Q,D,O,q,T,a,Z,k,K,M,t,R,f,P,E,e,A,Y,vW,Oo,QZ,D$,me,dd,Y6,Gm,iR,vg,pH,QF,lR,nd;return g.h(function(vY){if(vY.Y==1)return g.S(vY,GY(),2);if(vY.Y!=3){G=vY.V;if(!G)return vY.return();m=g.Yi("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.S(vY,BD(G,{mode:"readonly",p5:!0},function(p){return g.KY.all([Fi(p,m,"mainDownloadsListEntity"),Fi(p,g.lf,"mainDownloadsListEntity"),en(p,"mainVideoEntity"),en(p,"mainPlaylistEntity")])}),3)}w=vY.V;
W=g.V(w);U=W.next().value;c=W.next().value;Q=W.next().value;D=W.next().value;O=U;q=c;T=Q;a=D;Z=new Set;if((k=O)==null?0:(K=k.downloads)==null?0:K.length)for(M=g.V(O.downloads),t=M.next();!t.done;t=M.next())R=t.value,f=void 0,(P=(f=R.videoItem)!=null?f:R.playlistItem)&&Z.add(P);if((E=q)==null?0:(e=E.downloads)==null?0:e.length)for(A=g.V(q.downloads),Y=A.next();!Y.done;Y=A.next())vW=Y.value,vW.videoItem&&Z.add(vW.videoItem);Oo=new Set;QZ=[];D$=g.V(a);for(me=D$.next();!me.done;me=D$.next()){dd=me.value;
if(dd.videos)for(Y6=g.V(dd.videos),Gm=Y6.next();!Gm.done;Gm=Y6.next())iR=Gm.value,(vg=JSON.parse(g.Hd(iR).entityId).videoId)&&Oo.add(vg);dd.key&&!Z.has(dd.key)&&QZ.push(dd.key)}pH=g.V(T);for(QF=pH.next();!QF.done;QF=pH.next())lR=QF.value,lR.key&&!Z.has(lR.key)&&(nd=g.Hd(lR.key).entityId,Oo.has(nd)||QZ.push(lR.key));return QZ.length?g.S(vY,K3b(G,QZ),0):vY.sM(0)})};g.I(C6b,jt);C6b.prototype.Y=function(G){return qd(G)?J9m(this,G):TY(G)?r94(this,G):$v(G)?FGR(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var Ag=[10];g.I(n4d,jt);n4d.prototype.Y=function(G){return qd(G)?u7d(this,G):TY(G)?HXf(this,G):$v(G)?YnH(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var XF=[10];g.I(Xlq,jt);Xlq.prototype.Y=function(G){return qd(G)?wAn(this,G):TY(G)?WrH(this,G):$v(G)?U4R(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var m4g=[10];g.I(yk,uY);yk.prototype.mz=function(G){var m=uY.prototype.mz.call(this,G);m.musicTrack=new Xlq(G,this.V);m.musicPlaylist=new n4d(G,this.V);m.musicAlbumRelease=new C6b(G,this.V);return m};
yk.prototype.refreshAllStaleEntities=function(G,m){var w=this,W,U,c;return g.h(function(Q){if(Q.Y==1)return g.S(Q,cDq(w,G,m),2);if(Q.Y!=3)return U=W=Q.V,c=U.concat,g.S(Q,uY.prototype.refreshAllStaleEntities.call(w,G,m),3);W=c.call(U,Q.V);return Q.return(W)})};g.I(QmH,g.bK);g.N=QmH.prototype;g.N.create=function(){var G=this;g.r(this,this.events);if(g.Mu(this.h4))this.V=new o44(this.h4,this.player);else if(g.SX(this.h4)||g.bH(this.h4))this.V=new yk(this.h4,this.player);this.events.T(this.player,"onPlaybackStartExternal",function(){G.u_()});
this.events.T(this.player,"videodatachange",function(){G.u_()});
this.h4.J("html5_offline_playback_position_sync")&&this.events.T(this.player,"presentingplayerstatechange",this.tj)};
g.N.Xm=function(){return!1};
g.N.ob=function(G,m,w,W){var U=this;return g.h(function(c){return U.V?c.return(HS(U.V,G,m,w,W)):c.return(Promise.reject())})};
g.N.deleteAll=function(){return this.V.deleteAll()};
g.N.F3=function(G){return this.V.F3(G)};
g.N.refreshAllStaleEntities=function(G){return this.V.refreshAllStaleEntities(G)};
g.N.setUpPositionSyncInterval=function(G){this.V.setUpPositionSyncInterval(G)};
g.N.BZ=function(G){this.V.BZ(G)};
g.N.V3=function(G){return this.V.V3(G)};
g.N.u_=function(){var G=this,m;return g.h(function(w){m=G.player.getVideoData();return g.KB(m)?vyH(m)&&G.Y!==m.clientPlaybackNonce?g.S(w,D4z(G,m),0):w.sM(0):w.return()})};
g.N.tj=function(G){var m=this,w,W,U,c,Q,D,O;return g.h(function(q){if(q.Y==1)return w=m.player.getVideoData(),W=w.KG,g.qO(G,2)||g.qO(G,512)?g.S(q,GY(),2):q.return();if(q.Y!=3){U=q.V;if(!U)return Ui("PES is undefined"),q.return();c=w.videoId;return g.S(q,Xi(U,g.Yi(c,"mainVideoEntity"),"mainVideoEntity"),3)}Q=q.V;if(!Q)return q.return();D=Math.floor(W).toString();O={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:D}};return g.S(q,m.ob([c],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
O),0)})};
g.N.isOrchestrationLeader=function(){return this.V.isOrchestrationLeader()};
g.N.updateDownloadState=function(G,m){var w,W,U,c;return g.h(function(Q){if(Q.Y==1)return g.S(Q,GY(),2);w=Q.V;if(!w)return Ui("PES is undefined"),Q.return();W=g.Hd(G);U=W.entityType;c=W.entityId;return g.S(Q,ak(c,U,w,m,!0),0)})};g.Lf("offline",QmH);})(_yt_player);
